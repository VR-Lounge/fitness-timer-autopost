#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –¥–≤—É—Ö —Å—Ç–∞—Ç–µ–π –ø–æ –Ω–æ–≤—ã–º –ø—Ä–∞–≤–∏–ª–∞–º:
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã –∫–æ–Ω—Ç–µ–Ω—Ç—É
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ù–ï –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–µ–∫—Å—Ç, –ª–æ–≥–æ—Ç–∏–ø—ã, –≤–æ–¥—è–Ω—ã–µ –∑–Ω–∞–∫–∏
"""

import json
import sys
import os
import time
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ –º–æ–¥—É–ª—è–º
sys.path.insert(0, str(Path(__file__).parent))
from image_downloader import —Å–∫–∞—á–∞—Ç—å_–∏_–∑–∞–≥—Ä—É–∑–∏—Ç—å_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
from image_content_matcher import (
    –≤—ã–±—Ä–∞—Ç—å_–ª—É—á—à–µ–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ_–¥–ª—è_–∫–æ–Ω—Ç–µ–Ω—Ç–∞,
    –ø–æ–ª—É—á–∏—Ç—å_–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è_–∏–∑_–ø–æ—Å—Ç–æ–≤
)
from womenshealth_parser import –ø–∞—Ä—Å–∏—Ç—å_—Å—Ç–∞—Ç—å—é, WOMENSHEALTH_RSS_FEEDS, –ø–∞—Ä—Å–∏—Ç—å_rss_feed
from menshealth_parser import –ø–∞—Ä—Å–∏—Ç—å_—Å—Ç–∞—Ç—å—é as mens_–ø–∞—Ä—Å–∏—Ç—å_—Å—Ç–∞—Ç—å—é, MENSHEALTH_RSS_FEEDS, –ø–∞—Ä—Å–∏—Ç—å_rss_feed as mens_–ø–∞—Ä—Å–∏—Ç—å_rss_feed

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—É—Ç–∏
SCRIPT_DIR = Path(__file__).parent.absolute()
if (SCRIPT_DIR.parent / 'public_html').exists():
    REPO_ROOT = SCRIPT_DIR.parent
elif (SCRIPT_DIR / 'public_html').exists():
    REPO_ROOT = SCRIPT_DIR
else:
    REPO_ROOT = Path.cwd()

BLOG_POSTS_FILE = REPO_ROOT / 'public_html' / 'blog-posts.json'

def –Ω–∞–π—Ç–∏_–Ω–æ–≤—ã–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è_–∏–∑_rss(–∑–∞–≥–æ–ª–æ–≤–æ–∫, —Ç–µ–∫—Å—Ç, –∏—Å—Ç–æ—á–Ω–∏–∫):
    """–ù–∞—Ö–æ–¥–∏—Ç –Ω–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ RSS –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤"""
    print(f"üîç –ò—â—É –Ω–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ RSS –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤...")
    
    –≤—Å–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è = []
    
    # –í—ã–±–∏—Ä–∞–µ–º RSS –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –ø–æ—Å—Ç–∞
    rss_feeds = WOMENSHEALTH_RSS_FEEDS if –∏—Å—Ç–æ—á–Ω–∏–∫ == 'womenshealth' else MENSHEALTH_RSS_FEEDS
    
    # –ü–∞—Ä—Å–∏–º –±–æ–ª—å—à–µ RSS —Ñ–∏–¥–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    for rss_url in rss_feeds[:10]:  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–æ 10 —Ñ–∏–¥–æ–≤
        try:
            —Å—Ç–∞—Ç—å–∏ = –ø–∞—Ä—Å–∏—Ç—å_rss_feed(rss_url) if –∏—Å—Ç–æ—á–Ω–∏–∫ == 'womenshealth' else mens_–ø–∞—Ä—Å–∏—Ç—å_rss_feed(rss_url)
            
            # –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–µ 5 —Å—Ç–∞—Ç–µ–π –∏–∑ –∫–∞–∂–¥–æ–≥–æ —Ñ–∏–¥–∞ –¥–ª—è –±–æ–ª—å—à–µ–≥–æ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
            for —Å—Ç–∞—Ç—å—è in —Å—Ç–∞—Ç—å–∏[:5]:
                try:
                    parsed = –ø–∞—Ä—Å–∏—Ç—å_—Å—Ç–∞—Ç—å—é(—Å—Ç–∞—Ç—å—è['link']) if –∏—Å—Ç–æ—á–Ω–∏–∫ == 'womenshealth' else mens_–ø–∞—Ä—Å–∏—Ç—å_—Å—Ç–∞—Ç—å—é(—Å—Ç–∞—Ç—å—è['link'])
                    if parsed and parsed.get('images'):
                        –≤—Å–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.extend(parsed['images'])
                        print(f"  ‚úÖ –ù–∞–π–¥–µ–Ω–æ {len(parsed['images'])} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ {—Å—Ç–∞—Ç—å—è['link'][:50]}...")
                except Exception as e:
                    continue
        except Exception as e:
            continue
    
    print(f"üì∏ –í—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ {len(–≤—Å–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)} –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π")
    return –≤—Å–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

def –æ–±–Ω–æ–≤–∏—Ç—å_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è_–ø–æ—Å—Ç–∞(–ø–æ—Å—Ç, –≤—Å–µ_–ø–æ—Å—Ç—ã, —É–∂–µ_–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ_urls, –∏–Ω–¥–µ–∫—Å_–ø–æ—Å—Ç–∞=0):
    """–û–±–Ω–æ–≤–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ—Å—Ç–∞ –ø–æ –Ω–æ–≤—ã–º –ø—Ä–∞–≤–∏–ª–∞–º"""
    post_id = –ø–æ—Å—Ç.get('id', '')
    –∑–∞–≥–æ–ª–æ–≤–æ–∫ = –ø–æ—Å—Ç.get('title', '')
    —Ç–µ–∫—Å—Ç = –ø–æ—Å—Ç.get('text', '')
    –∏—Å—Ç–æ—á–Ω–∏–∫ = –ø–æ—Å—Ç.get('source', 'womenshealth')
    
    print(f"\n{'='*60}")
    print(f"üìù –û–±–Ω–æ–≤–ª—è—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –ø–æ—Å—Ç–∞: {–∑–∞–≥–æ–ª–æ–≤–æ–∫[:60]}...")
    print(f"   ID: {post_id}")
    print(f"   –ò—Å—Ç–æ—á–Ω–∏–∫: {–∏—Å—Ç–æ—á–Ω–∏–∫}")
    print(f"{'='*60}")
    
    # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ –¥—Ä—É–≥–∏—Ö –ø–æ—Å—Ç–æ–≤
    –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è = –ø–æ–ª—É—á–∏—Ç—å_–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è_–∏–∑_–ø–æ—Å—Ç–æ–≤(–≤—Å–µ_–ø–æ—Å—Ç—ã)
    # –î–æ–±–∞–≤–ª—è–µ–º —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –≤ —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏
    –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.extend(—É–∂–µ_–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ_urls)
    print(f"üîç –ü—Ä–æ–≤–µ—Ä—è—é —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å (—É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è {len(–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)")
    
    # –ò—â–µ–º –Ω–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ RSS
    –≤—Å–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è = –Ω–∞–π—Ç–∏_–Ω–æ–≤—ã–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è_–∏–∑_rss(–∑–∞–≥–æ–ª–æ–≤–æ–∫, —Ç–µ–∫—Å—Ç, –∏—Å—Ç–æ—á–Ω–∏–∫)
    
    if not –≤—Å–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:
        print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –Ω–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è")
        return False, None
    
    # –§–∏–ª—å—Ç—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
    —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è = []
    for img in –≤—Å–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:
        img_url = img.get('url', '')
        if not img_url:
            continue
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å
        normalized_url = img_url.split('?')[0].lower()
        –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è = any(
            normalized_url == existing_url.split('?')[0].lower()
            for existing_url in –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        )
        
        if not –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
            —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.append(img)
    
    if not —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:
        print("‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π")
        return False, None
    
    print(f"‚úÖ –ù–∞–π–¥–µ–Ω–æ {len(—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ {len(–≤—Å–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)}")
    
    # –ò—Å–∫–ª—é—á–∞–µ–º —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –≤ —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ_—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ = []
    for img in —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:
        img_url = img.get('url', '')
        if not img_url:
            continue
        
        normalized_url = img_url.split('?')[0].lower()
        –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è_–≤_—Å–µ—Å—Å–∏–∏ = any(
            normalized_url == existing_url.split('?')[0].lower()
            for existing_url in —É–∂–µ_–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ_urls
        )
        
        if not –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è_–≤_—Å–µ—Å—Å–∏–∏:
            —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ_—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ.append(img)
    
    if not —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ_—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ:
        print("‚ùå –í—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏")
        return False, None
    
    print(f"‚úÖ –ù–∞–π–¥–µ–Ω–æ {len(—Ñ–∏–Ω–∞–ª—å–Ω—ã–µ_—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ)} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –≤ —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏")
    
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º DeepSeek AI –¥–ª—è –≤—ã–±–æ—Ä–∞ –ª—É—á—à–µ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    print(f"\nü§ñ –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é {len(—Ñ–∏–Ω–∞–ª—å–Ω—ã–µ_—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ DeepSeek AI...")
    
    # –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ DeepSeek, –ø–µ—Ä–µ–¥–∞–≤–∞—è —Ç–∞–∫–∂–µ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –≤ —Å–µ—Å—Å–∏–∏ –∏ –∏–Ω–¥–µ–∫—Å –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
    –ª—É—á—à–µ–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ = –≤—ã–±—Ä–∞—Ç—å_–ª—É—á—à–µ–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ_–¥–ª—è_–∫–æ–Ω—Ç–µ–Ω—Ç–∞(
        —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ_—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ,
        –∑–∞–≥–æ–ª–æ–≤–æ–∫,
        —Ç–µ–∫—Å—Ç[:2000],  # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
        –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è,
        —É–∂–µ_–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ_urls,  # –ò—Å–∫–ª—é—á–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –≤ —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏
        –∏–Ω–¥–µ–∫—Å_–ø–æ—Å—Ç–∞  # –ü–µ—Ä–µ–¥–∞–µ–º –∏–Ω–¥–µ–∫—Å –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è –ø—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –æ—Ü–µ–Ω–∫–∞—Ö
    )
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–µ—Å—Å–∏–∏
    if –ª—É—á—à–µ–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:
        img_url = –ª—É—á—à–µ–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.get('url', '')
        normalized_url = img_url.split('?')[0].lower() if img_url else ''
        –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è_–≤_—Å–µ—Å—Å–∏–∏ = any(
            normalized_url == existing_url.split('?')[0].lower()
            for existing_url in —É–∂–µ_–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ_urls
        )
        
        if –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è_–≤_—Å–µ—Å—Å–∏–∏:
            print(f"‚ö†Ô∏è –í—ã–±—Ä–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–µ—Å—Å–∏–∏, –±–µ—Ä—É –¥—Ä—É–≥–æ–µ...")
            –ª—É—á—à–µ–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ = None
    
    # –ï—Å–ª–∏ DeepSeek –Ω–µ –≤—ã–±—Ä–∞–ª –∏–ª–∏ –≤—ã–±—Ä–∞–ª —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–æ–µ, –±–µ—Ä–µ–º –¥—Ä—É–≥–æ–µ –∏–∑ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞
    if not –ª—É—á—à–µ–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:
        print("‚ö†Ô∏è –ò—â—É —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–æ–µ –≤ —Å–µ—Å—Å–∏–∏...")
        # –î–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤ –≤—ã–±–∏—Ä–∞–µ–º —Ä–∞–∑–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–Ω–¥–µ–∫—Å)
        # –ù–∞—á–∏–Ω–∞–µ–º –ø–æ–∏—Å–∫ —Å –∏–Ω–¥–µ–∫—Å–∞ –ø–æ—Å—Ç–∞, —á—Ç–æ–±—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ—Å—Ç–∞ –±—ã–ª–æ —Ä–∞–∑–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        –Ω–∞—á–∞–ª—å–Ω—ã–π_–∏–Ω–¥–µ–∫—Å = –∏–Ω–¥–µ–∫—Å_–ø–æ—Å—Ç–∞ % len(—Ñ–∏–Ω–∞–ª—å–Ω—ã–µ_—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ) if —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ_—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ else 0
        
        # –ò—â–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –Ω–∞—á–∏–Ω–∞—è —Å –∏–Ω–¥–µ–∫—Å–∞ –ø–æ—Å—Ç–∞ (—á—Ç–æ–±—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤ –±—ã–ª–∏ —Ä–∞–∑–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
        for i in range(len(—Ñ–∏–Ω–∞–ª—å–Ω—ã–µ_—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ)):
            idx = (–Ω–∞—á–∞–ª—å–Ω—ã–π_–∏–Ω–¥–µ–∫—Å + i) % len(—Ñ–∏–Ω–∞–ª—å–Ω—ã–µ_—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ)
            img = —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ_—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ[idx]
            img_url_check = img.get('url', '')
            if not img_url_check:
                continue
            
            normalized_check = img_url_check.split('?')[0].lower()
            –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è = any(
                normalized_check == existing_url.split('?')[0].lower()
                for existing_url in —É–∂–µ_–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ_urls
            )
            if not –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
                –ª—É—á—à–µ–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ = img
                print(f"‚úÖ –ù–∞–π–¥–µ–Ω–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–∏–Ω–¥–µ–∫—Å {idx}): {img_url_check[:60]}...")
                break
        
        # –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –±–µ—Ä–µ–º –ø–æ –∏–Ω–¥–µ–∫—Å—É (–¥–∞–∂–µ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
        if not –ª—É—á—à–µ–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ and —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ_—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ:
            idx = –∏–Ω–¥–µ–∫—Å_–ø–æ—Å—Ç–∞ % len(—Ñ–∏–Ω–∞–ª—å–Ω—ã–µ_—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ)
            –ª—É—á—à–µ–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ = —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ_—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ[idx]
            print(f"‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ –∏–Ω–¥–µ–∫—Å—É {idx} (–≤–æ–∑–º–æ–∂–Ω–æ, —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)")
    
    img_url = –ª—É—á—à–µ–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.get('url', '')
    print(f"‚úÖ –í—ã–±—Ä–∞–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: {img_url[:80]}...")
    
    # –°–∫–∞—á–∏–≤–∞–µ–º –∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    print(f"üì• –°–∫–∞—á–∏–≤–∞—é –∏ –∑–∞–≥—Ä—É–∂–∞—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ...")
    –Ω–æ–≤—ã–π_url = —Å–∫–∞—á–∞—Ç—å_–∏_–∑–∞–≥—Ä—É–∑–∏—Ç—å_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ(img_url, post_id)
    
    if not –Ω–æ–≤—ã–π_url:
        print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–∞—á–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ")
        return False, None
    
    print(f"‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ: {–Ω–æ–≤—ã–π_url[:80]}...")
    
    # –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ—Å—Ç
    –ø–æ—Å—Ç['image'] = –Ω–æ–≤—ã–π_url
    if 'images' not in –ø–æ—Å—Ç or not –ø–æ—Å—Ç['images']:
        –ø–æ—Å—Ç['images'] = []
    
    # –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–∞–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –º–∞—Å—Å–∏–≤–µ images
    –æ–±–Ω–æ–≤–ª–µ–Ω–æ = False
    for img in –ø–æ—Å—Ç['images']:
        if img.get('is_main', False):
            img['url'] = –Ω–æ–≤—ã–π_url
            img['alt'] = –ª—É—á—à–µ–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.get('alt', '') or f"{–∑–∞–≥–æ–ª–æ–≤–æ–∫} - —Ñ–æ—Ç–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏"
            img['title'] = –ª—É—á—à–µ–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.get('title', '') or f"{–∑–∞–≥–æ–ª–æ–≤–æ–∫} - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"
            –æ–±–Ω–æ–≤–ª–µ–Ω–æ = True
            break
    
    if not –æ–±–Ω–æ–≤–ª–µ–Ω–æ:
        # –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ –≥–ª–∞–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        –ø–æ—Å—Ç['images'].insert(0, {
            'url': –Ω–æ–≤—ã–π_url,
            'alt': –ª—É—á—à–µ–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.get('alt', '') or f"{–∑–∞–≥–æ–ª–æ–≤–æ–∫} - —Ñ–æ—Ç–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏",
            'title': –ª—É—á—à–µ–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.get('title', '') or f"{–∑–∞–≥–æ–ª–æ–≤–æ–∫} - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ",
            'is_main': True
        })
    
    print(f"‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –ø–æ—Å—Ç–∞ {post_id}")
    return True, –Ω–æ–≤—ã–π_url

def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    if not BLOG_POSTS_FILE.exists():
        print(f"‚ùå –§–∞–π–ª {BLOG_POSTS_FILE} –Ω–µ –Ω–∞–π–¥–µ–Ω")
        return
    
    # –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ—Å—Ç—ã
    with open(BLOG_POSTS_FILE, 'r', encoding='utf-8') as f:
        data = json.load(f)
    
    –ø–æ—Å—Ç—ã = data.get('posts', [])
    print(f"üìù –ù–∞–π–¥–µ–Ω–æ –ø–æ—Å—Ç–æ–≤: {len(–ø–æ—Å—Ç—ã)}")
    
    if len(–ø–æ—Å—Ç—ã) < 2:
        print("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–æ—Å—Ç–æ–≤ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è")
        return
    
    # –ë–µ—Ä–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–≤–∞ –ø–æ—Å—Ç–∞
    –ø–æ—Å–ª–µ–¥–Ω–∏–µ_–¥–≤–∞_–ø–æ—Å—Ç–∞ = –ø–æ—Å—Ç—ã[:2]
    
    print(f"\nüéØ –û–±–Ω–æ–≤–ª—è—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –¥–≤—É—Ö –ø–æ—Å—Ç–æ–≤:")
    for i, –ø–æ—Å—Ç in enumerate(–ø–æ—Å–ª–µ–¥–Ω–∏–µ_–¥–≤–∞_–ø–æ—Å—Ç–∞, 1):
        print(f"   {i}. {–ø–æ—Å—Ç.get('title', '–ë–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞')[:60]}...")
    
    # –û–±–Ω–æ–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    –æ–±–Ω–æ–≤–ª–µ–Ω–æ = 0
    —É–∂–µ_–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ_urls = []  # –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ URL –≤ —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏
    –∏–Ω–¥–µ–∫—Å_–ø–æ—Å—Ç–∞ = 0  # –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –∏–Ω–¥–µ–∫—Å –ø–æ—Å—Ç–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ä–∞–∑–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    
    for –ø–æ—Å—Ç in –ø–æ—Å–ª–µ–¥–Ω–∏–µ_–¥–≤–∞_–ø–æ—Å—Ç–∞:
        —É—Å–ø–µ—Ö, –Ω–æ–≤—ã–π_url = –æ–±–Ω–æ–≤–∏—Ç—å_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è_–ø–æ—Å—Ç–∞(–ø–æ—Å—Ç, –ø–æ—Å—Ç—ã, —É–∂–µ_–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ_urls, –∏–Ω–¥–µ–∫—Å_–ø–æ—Å—Ç–∞)
        if —É—Å–ø–µ—Ö and –Ω–æ–≤—ã–π_url:
            –æ–±–Ω–æ–≤–ª–µ–Ω–æ += 1
            # –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π URL –≤ —Å–ø–∏—Å–æ–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–æ—Å—Ç–∞
            —É–∂–µ_–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ_urls.append(–Ω–æ–≤—ã–π_url)
        –∏–Ω–¥–µ–∫—Å_–ø–æ—Å—Ç–∞ += 1
        time.sleep(2)  # –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏
    
    if –æ–±–Ω–æ–≤–ª–µ–Ω–æ > 0:
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π JSON
        with open(BLOG_POSTS_FILE, 'w', encoding='utf-8') as f:
            json.dump(data, f, ensure_ascii=False, indent=2)
        print(f"\n‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ –ø–æ—Å—Ç–æ–≤: {–æ–±–Ω–æ–≤–ª–µ–Ω–æ}")
        print(f"üíæ –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ {BLOG_POSTS_FILE}")
    else:
        print(f"\n‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è")

if __name__ == '__main__':
    main()

name: üì§ –ó–∞–≥—Ä—É–∑–∫–∞ blog.html –Ω–∞ Yandex Cloud

on:
  workflow_dispatch:

jobs:
  upload-blog:
    name: –ó–∞–≥—Ä—É–∑–∫–∞ blog.html
    runs-on: ubuntu-latest
    
    steps:
      - name: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
        uses: actions/checkout@v4
        with:
          fetch-depth: 1
      
      - name: –ü—Ä–æ–≤–µ—Ä–∫–∞ AWS CLI
        run: |
          aws --version || echo "‚ö†Ô∏è AWS CLI –Ω–µ –Ω–∞–π–¥–µ–Ω, –Ω–æ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ runner"
      
      - name: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ AWS CLI –¥–ª—è –Ø–Ω–¥–µ–∫—Å Cloud
        env:
          YANDEX_ACCESS_KEY_ID: ${{ secrets.YANDEX_ACCESS_KEY_ID }}
          YANDEX_SECRET_ACCESS_KEY: ${{ secrets.YANDEX_SECRET_ACCESS_KEY }}
        run: |
          export AWS_ACCESS_KEY_ID="$YANDEX_ACCESS_KEY_ID"
          export AWS_SECRET_ACCESS_KEY="$YANDEX_SECRET_ACCESS_KEY"
          export AWS_DEFAULT_REGION="ru-central1"
          
          BUCKET_NAME="www.tabatatimer.ru"
          ENDPOINT_URL="https://storage.yandexcloud.net"
          
          echo "üì§ –ó–∞–≥—Ä—É–∑–∫–∞ blog.html –Ω–∞ –Ø–Ω–¥–µ–∫—Å Cloud..."
          
          # –ó–∞–≥—Ä—É–∂–∞–µ–º blog.html
          if [ -f "public_html/blog.html" ]; then
            aws s3 cp public_html/blog.html "s3://$BUCKET_NAME/blog.html" \
              --endpoint-url="$ENDPOINT_URL" \
              --acl public-read
            echo "‚úÖ blog.html –∑–∞–≥—Ä—É–∂–µ–Ω"
          else
            echo "‚ùå –§–∞–π–ª blog.html –Ω–µ –Ω–∞–π–¥–µ–Ω"
            exit 1
          fi
          
          # –ó–∞–≥—Ä—É–∂–∞–µ–º blog-posts.json
          if [ -f "public_html/blog-posts.json" ]; then
            aws s3 cp public_html/blog-posts.json "s3://$BUCKET_NAME/blog-posts.json" \
              --endpoint-url="$ENDPOINT_URL" \
              --acl public-read
            echo "‚úÖ blog-posts.json –∑–∞–≥—Ä—É–∂–µ–Ω"
          fi
          
          # –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å—Ç–∞—Ç–µ–π
          if [ -d "public_html/blog" ]; then
            aws s3 sync public_html/blog/ "s3://$BUCKET_NAME/blog/" \
              --endpoint-url="$ENDPOINT_URL" \
              --acl public-read \
              --exclude "*.DS_Store"
            echo "‚úÖ HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å—Ç–∞—Ç–µ–π –∑–∞–≥—Ä—É–∂–µ–Ω—ã"
          fi
          
          # –ó–∞–≥—Ä—É–∂–∞–µ–º sitemap.xml
          if [ -f "public_html/sitemap.xml" ]; then
            aws s3 cp public_html/sitemap.xml "s3://$BUCKET_NAME/sitemap.xml" \
              --endpoint-url="$ENDPOINT_URL" \
              --acl public-read
            echo "‚úÖ sitemap.xml –∑–∞–≥—Ä—É–∂–µ–Ω"
          fi
          
          echo "‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã –±–ª–æ–≥–∞ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –Ω–∞ –Ø–Ω–¥–µ–∫—Å Cloud!"

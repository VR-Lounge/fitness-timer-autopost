name: üìù –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç–∞—Ç–µ–π

on:
  workflow_dispatch:
  schedule:
    # –ó–∞–ø—É—Å–∫–∞–µ–º 1 —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é (–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Å—Ç–∞—Ç–µ–π
    - cron: '0 12 * * 1'  # –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ 12:00 UTC (15:00 –ú–°–ö)

jobs:
  expand-articles:
    name: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å—Ç–∞—Ç–µ–π
    runs-on: ubuntu-latest
    permissions:
      contents: write
      actions: read
    
    steps:
      - name: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è fitness-timer-autopost
        uses: actions/checkout@v4
        with:
          path: fitness-timer-autopost
      
      - name: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è tabatatimer-ru (public_html)
        uses: actions/checkout@v4
        with:
          repository: VR-Lounge/tabatatimer-ru
          path: public_html
          token: ${{ secrets.PAT_CROSS_REPO }}
      
      - name: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
        working-directory: fitness-timer-autopost
        run: |
          pip install --upgrade pip
          pip install requests beautifulsoup4 lxml
      
      - name: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç–∞—Ç–µ–π
        working-directory: fitness-timer-autopost
        env:
          DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
        run: |
          python3 expand_existing_articles.py
      
      - name: –ö–æ–º–º–∏—Ç –∏ –ø—É—à –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ tabatatimer-ru
        working-directory: public_html
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add blog-posts.json blog/*.html sitemap.xml
          git diff --staged --quiet || git commit -m "üìù –†–∞—Å—à–∏—Ä–µ–Ω –∫–æ–Ω—Ç–µ–Ω—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç–∞—Ç–µ–π –¥–æ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π"
          git push
      
      - name: –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –Ω–∞ Yandex Cloud
        working-directory: public_html
        env:
          YANDEX_ACCESS_KEY_ID: ${{ secrets.YANDEX_ACCESS_KEY_ID }}
          YANDEX_SECRET_ACCESS_KEY: ${{ secrets.YANDEX_SECRET_ACCESS_KEY }}
        run: |
          if [ -n "$YANDEX_ACCESS_KEY_ID" ] && [ -n "$YANDEX_SECRET_ACCESS_KEY" ]; then
            bash ../fitness-timer-autopost/upload_blog_to_yandex.sh
          else
            echo "‚ö†Ô∏è Yandex Cloud credentials –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É"
          fi

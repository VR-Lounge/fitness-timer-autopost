#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
    –ú–æ–¥—É–ª—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç—É —Å—Ç–∞—Ç—å–∏ —á–µ—Ä–µ–∑ DeepSeek AI
    
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç DeepSeek AI –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç—É —Å—Ç–∞—Ç—å–∏
    –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –º–µ–∂–¥—É –ø–æ—Å—Ç–∞–º–∏.
    
    –ê–≤—Ç–æ—Ä: VR-Lounge
"""

import os
import requests
import json
from pathlib import Path
from typing import List, Dict, Tuple, Optional

DEEPSEEK_API_KEY = os.getenv('DEEPSEEK_API_KEY')

def –ø—Ä–æ–≤–µ—Ä–∏—Ç—å_—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è_–∫–æ–Ω—Ç–µ–Ω—Ç—É_—á–µ—Ä–µ–∑_deepseek(
    url_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: str,
    alt_—Ç–µ–∫—Å—Ç: str,
    –∑–∞–≥–æ–ª–æ–≤–æ–∫_—Å—Ç–∞—Ç—å–∏: str,
    —Ç–µ–∫—Å—Ç_—Å—Ç–∞—Ç—å–∏: str
) -> Tuple[bool, float, str]:
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç—É —Å—Ç–∞—Ç—å–∏ —á–µ—Ä–µ–∑ DeepSeek AI
    
    Args:
        url_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        alt_—Ç–µ–∫—Å—Ç: Alt —Ç–µ–∫—Å—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        –∑–∞–≥–æ–ª–æ–≤–æ–∫_—Å—Ç–∞—Ç—å–∏: –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∞—Ç—å–∏
        —Ç–µ–∫—Å—Ç_—Å—Ç–∞—Ç—å–∏: –¢–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏ (–ø–µ—Ä–≤—ã–µ 1000 —Å–∏–º–≤–æ–ª–æ–≤)
    
    Returns:
        (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç, –æ—Ü–µ–Ω–∫–∞_—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏, –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ)
        - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç: True –µ—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç—É
        - –æ—Ü–µ–Ω–∫–∞_—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏: –æ—Ç 0.0 –¥–æ 1.0
        - –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ: –∫—Ä–∞—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è
    """
    if not DEEPSEEK_API_KEY:
        # –ï—Å–ª–∏ DeepSeek –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º True (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º)
        return True, 0.5, "DeepSeek –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É"
    
    try:
        url = "https://api.deepseek.com/v1/chat/completions"
        
        headers = {
            "Content-Type": "application/json",
            "Authorization": f"Bearer {DEEPSEEK_API_KEY}"
        }
        
        system_prompt = """–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∞–Ω–∞–ª–∏–∑—É —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç—É —Å—Ç–∞—Ç–µ–π –æ —Ñ–∏—Ç–Ω–µ—Å–µ –∏ –∑–¥–æ—Ä–æ–≤—å–µ.

–¢–≤–æ—è –∑–∞–¥–∞—á–∞: –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–ø–æ –µ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—é/alt —Ç–µ–∫—Å—Ç—É) –∫–æ–Ω—Ç–µ–Ω—Ç—É —Å—Ç–∞—Ç—å–∏.

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (—Å—Ç—Ä–æ–≥–æ JSON):
{
  "—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç": true/false,
  "–æ—Ü–µ–Ω–∫–∞": 0.0-1.0,
  "–æ–±—ä—è—Å–Ω–µ–Ω–∏–µ": "–∫—Ä–∞—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)",
  "–µ—Å—Ç—å_–ª–æ–≥–æ—Ç–∏–ø": true/false,
  "–µ—Å—Ç—å_—Ç–µ–∫—Å—Ç_–Ω–∞_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏": true/false,
  "—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å_–∫–æ–Ω—Ç–µ–Ω—Ç—É": "–≤—ã—Å–æ–∫–∞—è/—Å—Ä–µ–¥–Ω—è—è/–Ω–∏–∑–∫–∞—è"
}

–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–´–ï –ö–†–ò–¢–ï–†–ò–ò:
1. –ù–ï–¢ –õ–û–ì–û–¢–ò–ü–û–í –ò –¢–ï–ö–°–¢–ê –ù–ê –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ò:
   - –ï—Å–ª–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –µ—Å—Ç—å –ª–æ–≥–æ—Ç–∏–ø—ã, –Ω–∞–¥–ø–∏—Å–∏, —Ç–µ–∫—Å—Ç, –±—É–∫–≤—ã, –Ω–∞–∑–≤–∞–Ω–∏—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π, –ø–æ–¥–∫–∞—Å—Ç–æ–≤ - –≤–µ—Ä–Ω–∏ "–µ—Å—Ç—å_–ª–æ–≥–æ—Ç–∏–ø": true –∏–ª–∏ "–µ—Å—Ç—å_—Ç–µ–∫—Å—Ç_–Ω–∞_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏": true
   - –¢–∞–∫–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ù–ï –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –±–ª–æ–≥–∞ –æ —Ñ–∏—Ç–Ω–µ—Å–µ
   - –ù—É–∂–Ω—ã –ß–ò–°–¢–´–ï —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –ª—é–¥–µ–π, –∑–∞–Ω–∏–º–∞—é—â–∏—Ö—Å—è —Ñ–∏—Ç–Ω–µ—Å–æ–º, –±–µ–∑ —Ç–µ–∫—Å—Ç–∞ –∏ –ª–æ–≥–æ—Ç–∏–ø–æ–≤

2. –†–ï–õ–ï–í–ê–ù–¢–ù–û–°–¢–¨ –ö–û–ù–¢–ï–ù–¢–£:
   - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –æ—Ç—Ä–∞–∂–∞—Ç—å —Ç–µ–º—É —Å—Ç–∞—Ç—å–∏ (—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏, –ø–∏—Ç–∞–Ω–∏–µ, –º–æ—Ç–∏–≤–∞—Ü–∏—è)
   - –î–ª—è —Å—Ç–∞—Ç–µ–π –ø—Ä–æ —Å–∏–ª–æ–≤—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –≤–µ—Å–∞–º–∏, —Ç—Ä–µ–Ω–∞–∂–µ—Ä–∞–º–∏, –ª—é–¥—å–º–∏ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
   - –î–ª—è —Å—Ç–∞—Ç–µ–π –ø—Ä–æ –ø–∏—Ç–∞–Ω–∏–µ - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –µ–¥–æ–π, –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏
   - –î–ª—è —Å—Ç–∞—Ç–µ–π –ø—Ä–æ –º–æ—Ç–∏–≤–∞—Ü–∏—é - –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ª—é–¥–µ–π –≤ —Ñ–∏—Ç–Ω–µ—Å–µ
   - –ò–∑–±–µ–≥–∞–π –æ–±—â–∏—Ö/–¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å —Ç–µ–º–æ–π

3. –ö–ê–ß–ï–°–¢–í–û –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–Ø:
   - –ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –¥–µ–≤—É—à–µ–∫ –∏ –º—É–∂—á–∏–Ω, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–Ω–∏–º–∞—é—Ç—Å—è —Ñ–∏—Ç–Ω–µ—Å–æ–º
   - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏, —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
   - –ò–∑–±–µ–≥–∞–π —Å—Ç–∞—Ç–∏—á–Ω—ã—Ö –ø–æ—Ä—Ç—Ä–µ—Ç–æ–≤, –≥–æ–ª–æ–≤–æ–∫, –ø—Ä–æ—Å—Ç—ã—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –ª—é–¥–µ–π –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Ñ–∏—Ç–Ω–µ—Å–∞

–ë—É–¥—å –û–ß–ï–ù–¨ —Å—Ç—Ä–æ–≥–∏–º: –µ—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–æ–≥–æ—Ç–∏–ø—ã, —Ç–µ–∫—Å—Ç, –Ω–∞–¥–ø–∏—Å–∏, –∏–ª–∏ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–µ–º–µ - –≤–µ—Ä–Ω–∏ "—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç": false."""
        
        user_prompt = f"""–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∞—Ç—å–∏: {–∑–∞–≥–æ–ª–æ–≤–æ–∫_—Å—Ç–∞—Ç—å–∏}

–¢–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏ (–ø–µ—Ä–≤—ã–µ 1000 —Å–∏–º–≤–æ–ª–æ–≤): {—Ç–µ–∫—Å—Ç_—Å—Ç–∞—Ç—å–∏[:1000]}

–û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (alt —Ç–µ–∫—Å—Ç): {alt_—Ç–µ–∫—Å—Ç or '–Ω–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è'}

URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: {url_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è[:100]}

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç—É —Å—Ç–∞—Ç—å–∏. –í–µ—Ä–Ω–∏ —Ç–æ–ª—å–∫–æ JSON –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞."""
        
        data = {
            "model": "deepseek-chat",
            "messages": [
                {"role": "system", "content": system_prompt},
                {"role": "user", "content": user_prompt}
            ],
            "temperature": 0.3,  # –ù–∏–∑–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
            "max_tokens": 200,
            "response_format": {"type": "json_object"}
        }
        
        response = requests.post(url, headers=headers, json=data, timeout=30)
        response.raise_for_status()
        
        result = response.json()
        –æ—Ç–≤–µ—Ç = result['choices'][0]['message']['content']
        
        # –ü–∞—Ä—Å–∏–º JSON –æ—Ç–≤–µ—Ç
        try:
            –∞–Ω–∞–ª–∏–∑ = json.loads(–æ—Ç–≤–µ—Ç)
            —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç = –∞–Ω–∞–ª–∏–∑.get('—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç', True)
            –æ—Ü–µ–Ω–∫–∞ = float(–∞–Ω–∞–ª–∏–∑.get('–æ—Ü–µ–Ω–∫–∞', 0.5))
            –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ = –∞–Ω–∞–ª–∏–∑.get('–æ–±—ä—è—Å–Ω–µ–Ω–∏–µ', '–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞')
            –µ—Å—Ç—å_–ª–æ–≥–æ—Ç–∏–ø = –∞–Ω–∞–ª–∏–∑.get('–µ—Å—Ç—å_–ª–æ–≥–æ—Ç–∏–ø', False)
            –µ—Å—Ç—å_—Ç–µ–∫—Å—Ç = –∞–Ω–∞–ª–∏–∑.get('–µ—Å—Ç—å_—Ç–µ–∫—Å—Ç_–Ω–∞_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏', False)
            
            # –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–í–ï–†–ö–ê: –ï—Å–ª–∏ –µ—Å—Ç—å –ª–æ–≥–æ—Ç–∏–ø –∏–ª–∏ —Ç–µ–∫—Å—Ç - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫–ª–æ–Ω—è–µ–º
            if –µ—Å—Ç—å_–ª–æ–≥–æ—Ç–∏–ø or –µ—Å—Ç—å_—Ç–µ–∫—Å—Ç:
                print(f"  ‚ùå –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ: –æ–±–Ω–∞—Ä—É–∂–µ–Ω –ª–æ–≥–æ—Ç–∏–ø –∏–ª–∏ —Ç–µ–∫—Å—Ç –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏")
                print(f"     –õ–æ–≥–æ—Ç–∏–ø: {–µ—Å—Ç—å_–ª–æ–≥–æ—Ç–∏–ø}, –¢–µ–∫—Å—Ç: {–µ—Å—Ç—å_—Ç–µ–∫—Å—Ç}")
                return False, 0.0, f"–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–æ–≥–æ—Ç–∏–ø –∏–ª–∏ —Ç–µ–∫—Å—Ç (–Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –±–ª–æ–≥–∞)"
            
            # –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê: –ü—Ä–æ–≤–µ—Ä—è–µ–º alt/title —Ç–µ–∫—Å—Ç –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –ø–æ–¥–∫–∞—Å—Ç–æ–≤, –ª–æ–≥–æ—Ç–∏–ø–æ–≤
            alt_–Ω–∏–∂–Ω–∏–π = (alt_—Ç–µ–∫—Å—Ç or '').lower()
            if any(–º–∞—Ä–∫–µ—Ä in alt_–Ω–∏–∂–Ω–∏–π for –º–∞—Ä–∫–µ—Ä in ['podcast', 'episode', 'logo', 'training science', 'the training science']):
                print(f"  ‚ùå –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ: alt/title —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∏–∑–Ω–∞–∫–∏ –ø–æ–¥–∫–∞—Å—Ç–∞/–ª–æ–≥–æ—Ç–∏–ø–∞")
                return False, 0.0, f"–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–æ —Å –ø–æ–¥–∫–∞—Å—Ç–æ–º/–ª–æ–≥–æ—Ç–∏–ø–æ–º (–Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –±–ª–æ–≥–∞)"
            
            return —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç, –æ—Ü–µ–Ω–∫–∞, –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ
        except (json.JSONDecodeError, ValueError, KeyError):
            # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å, —Å—á–∏—Ç–∞–µ–º —á—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç
            return True, 0.5, "–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞ DeepSeek"
    
    except Exception as e:
        print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —á–µ—Ä–µ–∑ DeepSeek: {e}")
        # –ü—Ä–∏ –æ—à–∏–±–∫–µ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º, –Ω–æ –ª–æ–≥–∏—Ä—É–µ–º
        return True, 0.5, f"–û—à–∏–±–∫–∞: {str(e)[:50]}"

def –≤—ã–±—Ä–∞—Ç—å_–ª—É—á—à–µ–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ_–¥–ª—è_–∫–æ–Ω—Ç–µ–Ω—Ç–∞(
    —Å–ø–∏—Å–æ–∫_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: List[Dict],
    –∑–∞–≥–æ–ª–æ–≤–æ–∫_—Å—Ç–∞—Ç—å–∏: str,
    —Ç–µ–∫—Å—Ç_—Å—Ç–∞—Ç—å–∏: str,
    —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: List[str] = None,
    –∏—Å–∫–ª—é—á–∏—Ç—å_urls: List[str] = None,
    –Ω–∞—á–∞–ª—å–Ω—ã–π_–∏–Ω–¥–µ–∫—Å: int = 0
) -> Optional[Dict]:
    """
    –í—ã–±–∏—Ä–∞–µ—Ç –ª—É—á—à–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç—É
    
    Args:
        —Å–ø–∏—Å–æ–∫_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å url, alt, title
        –∑–∞–≥–æ–ª–æ–≤–æ–∫_—Å—Ç–∞—Ç—å–∏: –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∞—Ç—å–∏
        —Ç–µ–∫—Å—Ç_—Å—Ç–∞—Ç—å–∏: –¢–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏
        —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: –°–ø–∏—Å–æ–∫ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –≤ –¥—Ä—É–≥–∏—Ö –ø–æ—Å—Ç–∞—Ö
        –∏—Å–∫–ª—é—á–∏—Ç—å_urls: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ URL –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –≤ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏)
        –Ω–∞—á–∞–ª—å–Ω—ã–π_–∏–Ω–¥–µ–∫—Å: –ù–∞—á–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –¥–ª—è –≤—ã–±–æ—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è –ø—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –æ—Ü–µ–Ω–∫–∞—Ö)
    
    Returns:
        –õ—É—á—à–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (—Å–ª–æ–≤–∞—Ä—å) –∏–ª–∏ None
    """
    if not —Å–ø–∏—Å–æ–∫_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:
        return None
    
    if —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è is None:
        —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è = []
    if –∏—Å–∫–ª—é—á–∏—Ç—å_urls is None:
        –∏—Å–∫–ª—é—á–∏—Ç—å_urls = []
    
    # –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ –∏—Å–∫–ª—é—á–∞–µ–º—ã–µ URL
    –≤—Å–µ_–∏—Å–∫–ª—é—á–∞–µ–º—ã–µ = list(—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è) + list(–∏—Å–∫–ª—é—á–∏—Ç—å_urls)
    
    # –§–∏–ª—å—Ç—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –¥—Ä—É–≥–∏—Ö –ø–æ—Å—Ç–∞—Ö –∏–ª–∏ –≤ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏
    —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è = []
    for img in —Å–ø–∏—Å–æ–∫_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:
        img_url = img.get('url', '')
        if not img_url:
            continue
        
        # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º URL –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
        normalized_url = img_url.split('?')[0].lower()
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è = False
        for existing_url in –≤—Å–µ_–∏—Å–∫–ª—é—á–∞–µ–º—ã–µ:
            if normalized_url == existing_url.split('?')[0].lower():
                –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è = True
                break
        
        if not –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
            —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.append(img)
    
    if not —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:
        print("‚ö†Ô∏è –í—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –¥—Ä—É–≥–∏—Ö –ø–æ—Å—Ç–∞—Ö")
        # –ï—Å–ª–∏ –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, –±–µ—Ä–µ–º –ø–µ—Ä–≤–æ–µ (–Ω–æ —ç—Ç–æ –Ω–µ –∏–¥–µ–∞–ª—å–Ω–æ)
        return —Å–ø–∏—Å–æ–∫_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π[0] if —Å–ø–∏—Å–æ–∫_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π else None
    
    # –û—Ü–µ–Ω–∏–≤–∞–µ–º –∫–∞–∂–¥–æ–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ DeepSeek
    –æ—Ü–µ–Ω–∫–∏_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π = []
    for img in —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è[:10]:  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–æ 10 –¥–ª—è –±–æ–ª—å—à–µ–≥–æ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
        img_url = img.get('url', '')
        alt_—Ç–µ–∫—Å—Ç = img.get('alt', '') or img.get('title', '')
        
        —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç, –æ—Ü–µ–Ω–∫–∞, –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ = –ø—Ä–æ–≤–µ—Ä–∏—Ç—å_—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è_–∫–æ–Ω—Ç–µ–Ω—Ç—É_—á–µ—Ä–µ–∑_deepseek(
            img_url, alt_—Ç–µ–∫—Å—Ç, –∑–∞–≥–æ–ª–æ–≤–æ–∫_—Å—Ç–∞—Ç—å–∏, —Ç–µ–∫—Å—Ç_—Å—Ç–∞—Ç—å–∏
        )
        
        –æ—Ü–µ–Ω–∫–∏_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.append({
            '–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ': img,
            '—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç': —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç,
            '–æ—Ü–µ–Ω–∫–∞': –æ—Ü–µ–Ω–∫–∞,
            '–æ–±—ä—è—Å–Ω–µ–Ω–∏–µ': –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ
        })
        
        print(f"  üìä –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ {img_url[:50]}...: –æ—Ü–µ–Ω–∫–∞ {–æ—Ü–µ–Ω–∫–∞:.2f}, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç={—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç}")
        if –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ:
            print(f"     {–æ–±—ä—è—Å–Ω–µ–Ω–∏–µ}")
    
    # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –æ—Ü–µ–Ω–∫–µ (–ª—É—á—à–∏–µ –ø–µ—Ä–≤—ã–º–∏)
    –æ—Ü–µ–Ω–∫–∏_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.sort(key=lambda x: x['–æ—Ü–µ–Ω–∫–∞'], reverse=True)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—Å–µ –ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é –æ—Ü–µ–Ω–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, 0.50 –∫–æ–≥–¥–∞ DeepSeek –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
    –≤—Å–µ_–æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ_–æ—Ü–µ–Ω–∫–∏ = len(–æ—Ü–µ–Ω–∫–∏_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π) > 0 and all(
        abs(–æ—Ü–µ–Ω–∫–∞['–æ—Ü–µ–Ω–∫–∞'] - –æ—Ü–µ–Ω–∫–∏_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π[0]['–æ—Ü–µ–Ω–∫–∞']) < 0.01
        for –æ—Ü–µ–Ω–∫–∞ in –æ—Ü–µ–Ω–∫–∏_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    )
    
    # –ï—Å–ª–∏ –≤—Å–µ –æ—Ü–µ–Ω–∫–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–Ω–¥–µ–∫—Å –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
    if –≤—Å–µ_–æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ_–æ—Ü–µ–Ω–∫–∏ and len(–æ—Ü–µ–Ω–∫–∏_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π) > 1:
        # –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –∫–æ–Ω—Ç–µ–Ω—Ç—É
        —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ = [–æ for –æ in –æ—Ü–µ–Ω–∫–∏_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π if –æ['—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç']]
        if —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ:
            idx = –Ω–∞—á–∞–ª—å–Ω—ã–π_–∏–Ω–¥–µ–∫—Å % len(—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ)
            –≤—ã–±—Ä–∞–Ω–Ω–æ–µ = —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ[idx]
            print(f"‚úÖ –í—ã–±—Ä–∞–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ –∏–Ω–¥–µ–∫—Å—É {idx} (–≤—Å–µ –æ—Ü–µ–Ω–∫–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ): –æ—Ü–µ–Ω–∫–∞ {–≤—ã–±—Ä–∞–Ω–Ω–æ–µ['–æ—Ü–µ–Ω–∫–∞']:.2f}")
            return –≤—ã–±—Ä–∞–Ω–Ω–æ–µ['–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ']
    
    # –í—ã–±–∏—Ä–∞–µ–º –ª—É—á—à–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç—É
    for –æ—Ü–µ–Ω–∫–∞_–¥–∞–Ω–Ω—ã–µ in –æ—Ü–µ–Ω–∫–∏_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:
        if –æ—Ü–µ–Ω–∫–∞_–¥–∞–Ω–Ω—ã–µ['—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç']:
            print(f"‚úÖ –í—ã–±—Ä–∞–Ω–æ –ª—É—á—à–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: –æ—Ü–µ–Ω–∫–∞ {–æ—Ü–µ–Ω–∫–∞_–¥–∞–Ω–Ω—ã–µ['–æ—Ü–µ–Ω–∫–∞']:.2f}")
            return –æ—Ü–µ–Ω–∫–∞_–¥–∞–Ω–Ω—ã–µ['–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ']
    
    # –ï—Å–ª–∏ –Ω–∏ –æ–¥–Ω–æ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ, –±–µ—Ä–µ–º –ª—É—á—à–µ–µ –ø–æ –æ—Ü–µ–Ω–∫–µ
    if –æ—Ü–µ–Ω–∫–∏_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:
        print(f"‚ö†Ô∏è –í—ã–±—Ä–∞–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –Ω–∞–∏–ª—É—á—à–µ–π –æ—Ü–µ–Ω–∫–æ–π: {–æ—Ü–µ–Ω–∫–∏_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π[0]['–æ—Ü–µ–Ω–∫–∞']:.2f}")
        return –æ—Ü–µ–Ω–∫–∏_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π[0]['–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ']
    
    # –ï—Å–ª–∏ –Ω–µ—Ç –æ—Ü–µ–Ω–æ–∫ (DeepSeek –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω), –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –ø–æ –∏–Ω–¥–µ–∫—Å—É –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
    if —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:
        idx = –Ω–∞—á–∞–ª—å–Ω—ã–π_–∏–Ω–¥–µ–∫—Å % len(—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
        print(f"‚ö†Ô∏è DeepSeek –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –≤–æ–∑–≤—Ä–∞—â–∞—é —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–∏–Ω–¥–µ–∫—Å {idx})")
        return —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è[idx]
    
    return None

def –ø–æ–ª—É—á–∏—Ç—å_–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è_–∏–∑_–ø–æ—Å—Ç–æ–≤(—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ_–ø–æ—Å—Ç—ã: List[Dict]) -> List[str]:
    """
    –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Å–ø–∏—Å–æ–∫ URL –≤—Å–µ—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ—Å—Ç–∞—Ö
    
    Args:
        —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ_–ø–æ—Å—Ç—ã: –°–ø–∏—Å–æ–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ—Å—Ç–æ–≤ –∏–∑ blog-posts.json
    
    Returns:
        –°–ø–∏—Å–æ–∫ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    """
    –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ_urls = []
    
    for –ø–æ—Å—Ç in —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ_–ø–æ—Å—Ç—ã:
        # –ì–ª–∞–≤–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        –≥–ª–∞–≤–Ω–æ–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ = –ø–æ—Å—Ç.get('image', '')
        if –≥–ª–∞–≤–Ω–æ–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:
            –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ_urls.append(–≥–ª–∞–≤–Ω–æ–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ)
        
        # –í—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ –º–∞—Å—Å–∏–≤–∞ images
        –≤—Å–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è = –ø–æ—Å—Ç.get('images', [])
        for img_dict in –≤—Å–µ_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:
            img_url = img_dict.get('url', '')
            if img_url:
                –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ_urls.append(img_url)
    
    return –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ_urls

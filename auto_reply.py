#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
    –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–≤–µ—Ç –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ Telegram
    
    –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ–¥ –ø–æ—Å—Ç–∞–º–∏ —á–µ—Ä–µ–∑ DeepSeek AI
    –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —á–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã.
    
    –ê–≤—Ç–æ—Ä: VR-Lounge
    –ö–∞–Ω–∞–ª: @fitnesstimer
"""

import os
import requests
import json
import re
import random
from datetime import datetime
from pathlib import Path

# ============= –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø =============

TELEGRAM_BOT_TOKEN = os.getenv('TELEGRAM_BOT_TOKEN')
TELEGRAM_CHAT_ID = os.getenv('TELEGRAM_CHAT_ID')
DEEPSEEK_API_KEY = os.getenv('DEEPSEEK_API_KEY')

# –§–∞–π–ª –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ update_id
STATE_FILE = Path('.auto_reply_state.json')

# –§–∞–π–ª –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç–∑—ã–≤–æ–≤ –æ —Ç–∞–π–º–µ—Ä–µ/—Å–∞–π—Ç–µ
FEEDBACK_FILE = Path('feedback_timer.md')

# –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –≤–æ–ø—Ä–æ—Å–∞ –¥–ª—è –æ—Ç–≤–µ—Ç–∞
MIN_QUESTION_LENGTH = 10

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –≤–æ–ø—Ä–æ—Å–∞ (—á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–ø–∞–º)
MAX_QUESTION_LENGTH = 500

# –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å
QUESTION_KEYWORDS = [
    '–∫–∞–∫', '—á—Ç–æ', '–ø–æ—á–µ–º—É', '–≥–¥–µ', '–∫–æ–≥–¥–∞', '—Å–∫–æ–ª—å–∫–æ', '–º–æ–∂–Ω–æ', 
    '–Ω—É–∂–Ω–æ', '–ø–æ–º–æ–≥–∏', '–ø–æ–¥—Å–∫–∞–∂–∏', '–æ–±—ä—è—Å–Ω–∏', '—Ä–∞—Å—Å–∫–∞–∂–∏',
    '–∫–∞–∫–æ–π', '–∫–∞–∫–∞—è', '–∫–∞–∫–æ–µ', '–∫–∞–∫–∏–µ', '—á–µ–º', '–∑–∞—á–µ–º'
]

# –°–ª–æ–≤–∞-—Ç—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
AUTO_REPLY_TRIGGERS = [
    '—Ç–∞–π–º–µ—Ä', 'tabata', 'hiit', 'amrap', 'emom', '—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞',
    '—É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ', '–ø—Ä–æ–≥—Ä–∞–º–º–∞', '—Ä–µ—Ü–µ–ø—Ç', '–ø–∏—Ç–∞–Ω–∏–µ', '–¥–∏–µ—Ç–∞',
    '–∫–∞–∫ –Ω–∞—á–∞—Ç—å', '—Å —á–µ–≥–æ –Ω–∞—á–∞—Ç—å', '–Ω–æ–≤–∏—á–æ–∫', '–Ω–∞—á–∞–ª—å–Ω—ã–π',
    '—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑', '—Å–∫–æ–ª—å–∫–æ –ø–æ–¥—Ö–æ–¥–æ–≤', '–∫–∞–∫ –¥–µ–ª–∞—Ç—å'
]

# –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—Ç–∑—ã–≤–æ–≤/–≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ —Ç–∞–π–º–µ—Ä/—Å–∞–π—Ç
–¢–ê–ô–ú–ï–†_–ö–õ–Æ–ß–ï–í–´–ï_–°–õ–û–í–ê = [
    'tabatatimer', 'tabatatimer.ru', '—Ç–∞–π–º–µ—Ä', '—Å–∞–π—Ç', '—Å–∞–π—Ç–∞', '—Å–∞–π—Ç–µ',
    '–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç', '–Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è', '–≥–ª—é—á–∏—Ç', '–±–∞–≥', '–æ—à–∏–±–∫–∞', '–ø—Ä–æ–±–ª–µ–º–∞',
    '–∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è', '–∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å', '–Ω–µ –ø–æ–Ω–∏–º–∞—é', '–Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è',
    '–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ', '–ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å', '—É–ª—É—á—à–∏—Ç—å', '–¥–æ–±–∞–≤–∏—Ç—å', '—Ö–æ—á—É —á—Ç–æ–±—ã',
    '–±—ã–ª–æ –±—ã —Ö–æ—Ä–æ—à–æ', '–Ω–µ—É–¥–æ–±–Ω–æ', '–Ω–µ—É–¥–æ–±–Ω—ã–π', '—Å–ª–æ–∂–Ω–æ', '–Ω–µ–ø–æ–Ω—è—Ç–Ω–æ',
    '–æ—Ç–∑—ã–≤', '–∑–∞–º–µ—á–∞–Ω–∏–µ', '–∂–∞–ª–æ–±–∞', '–∫—Ä–∏—Ç–∏–∫–∞'
]

# –°–ª–æ–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ —Å–ø–∞–º (–Ω–µ –æ—Ç–≤–µ—á–∞–µ–º)
SPAM_KEYWORDS = [
    '–∫—É–ø–∏—Ç—å', '–ø—Ä–æ–¥–∞—Ç—å', '–∑–∞—Ä–∞–±–æ—Ç–æ–∫', '—Ä–µ–∫–ª–∞–º–∞', '—Å—Å—ã–ª–∫–∞',
    'bit.ly', 't.me/', 'http://', 'https://', '—Ä–µ—Ñ–µ—Ä–∞–ª'
]

# –ö–æ—Ä–æ—Ç–∫–∏–µ –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ—Ä–∞–∑—ã (–æ–±–µ–∑–ª–∏—á–µ–Ω–Ω—ã–µ, –≤ —Ç–µ–º—É)
–ú–û–¢–ò–í–ê–¶–ò–û–ù–ù–´–ï_–§–†–ê–ó–´ = [
    "–ë–æ–ª—å ‚Äî —ç—Ç–æ —Å–ª–∞–±–æ—Å—Ç—å, –ø–æ–∫–∏–¥–∞—é—â–∞—è —Ç–µ–ª–æ üí™",
    "–£—Å–ø–µ—Ö ‚Äî —ç—Ç–æ —Å—É–º–º–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —É—Å–∏–ª–∏–π –∫–∞–∂–¥—ã–π –¥–µ–Ω—å üî•",
    "–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–ª–æ—Ö–æ–π —Ç—Ä–µ–Ω–∏–Ω–≥ ‚Äî —Ç–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —Å–æ—Å—Ç–æ—è–ª—Å—è üíØ",
    "–¢–µ–ª–æ –º–æ–∂–µ—Ç –≤—Å—ë. –ù—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å —Ä–∞–∑—É–º üß†",
    "–ù–µ –∂–¥–∏ –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞. –ù–∞—á–Ω–∏ —Å–µ–π—á–∞—Å üöÄ",
    "–ë–æ–ª—å –≤—Ä–µ–º–µ–Ω–Ω–∞, –≥–æ—Ä–¥–æ—Å—Ç—å ‚Äî –Ω–∞–≤—Å–µ–≥–¥–∞ üíé",
    "–ö–∞–∂–¥—ã–π —ç–∫—Å–ø–µ—Ä—Ç –∫–æ–≥–¥–∞-—Ç–æ –±—ã–ª –Ω–æ–≤–∏—á–∫–æ–º ‚ö°",
    "–ü—Ä–æ–≥—Ä–µ—Å—Å –≤–∞–∂–Ω–µ–µ —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–∞ üåü",
    "–¢–≤–æ—ë –±—É–¥—É—â–µ–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ç–µ–º, —á—Ç–æ —Ç—ã –¥–µ–ª–∞–µ—à—å —Å–µ–≥–æ–¥–Ω—è üéØ",
    "–°–ª–æ–∂–Ω–æ–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–æ—Å—Ç—ã–º —Å –ø—Ä–∞–∫—Ç–∏–∫–æ–π üí™",
    "–ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Å—è, –∫–æ–≥–¥–∞ —É—Å—Ç–∞–ª. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Å—è, –∫–æ–≥–¥–∞ —Å–¥–µ–ª–∞–ª üî•",
    "–ú–æ—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–∏—Ö–æ–¥–∏—Ç –∏ —É—Ö–æ–¥–∏—Ç. –î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ –æ—Å—Ç–∞—ë—Ç—Å—è üíé",
    "–ú–∞–ª–µ–Ω—å–∫–∏–µ —à–∞–≥–∏ –≤–µ–¥—É—Ç –∫ –±–æ–ª—å—à–∏–º —Ü–µ–ª—è–º üö∂",
    "–°–µ–≥–æ–¥–Ω—è—à–Ω—è—è –±–æ–ª—å ‚Äî –∑–∞–≤—Ç—Ä–∞—à–Ω—è—è —Å–∏–ª–∞ üí™",
    "–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ ‚Äî —ç—Ç–æ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è –≤ —Å–µ–±—è üèÜ",
    "–õ—É—á—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—á–∞—Ç—å –±—ã–ª–æ –≤—á–µ—Ä–∞. –í—Ç–æ—Ä–æ–µ –ª—É—á—à–µ–µ ‚Äî —Å–µ–π—á–∞—Å ‚è∞",
    "–¢–≤–æ–π –ª–∏–º–∏—Ç ‚Äî —ç—Ç–æ —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ —Ç—ã —Å–µ–±–µ —É—Å—Ç–∞–Ω–æ–≤–∏–ª üöÄ",
    "–ö–∞–∂–¥–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç –∫ —Ü–µ–ª–∏ üéØ",
    "–£—Å—Ç–∞–ª–æ—Å—Ç—å ‚Äî –ø—Ä–∏–∑–Ω–∞–∫ —Ç–æ–≥–æ, —á—Ç–æ —Ç—ã –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø—É—Ç–∏ üíØ",
    "–ù–µ —Å—Ä–∞–≤–Ω–∏–≤–∞–π —Å–µ–±—è —Å –¥—Ä—É–≥–∏–º–∏. –°—Ä–∞–≤–Ω–∏–≤–∞–π —Å —Å–æ–±–æ–π –≤—á–µ—Ä–∞—à–Ω–∏–º üìà",
    "–¢–µ—Ä–ø–µ–Ω–∏–µ –∏ —É–ø–æ—Ä—Å—Ç–≤–æ –ø–æ–±–µ–∂–¥–∞—é—Ç —Ç–∞–ª–∞–Ω—Ç üèÖ",
    "–¢—Ä–µ–Ω–∏—Ä—É–π—Å—è –Ω–µ –ø–æ—Ç–æ–º—É —á—Ç–æ –Ω–µ–Ω–∞–≤–∏–¥–∏—à—å —Å–≤–æ—ë —Ç–µ–ª–æ, –∞ –ø–æ—Ç–æ–º—É —á—Ç–æ –ª—é–±–∏—à—å –µ–≥–æ ‚ù§Ô∏è",
    "–ö–∞–ø–ª—è –∫–∞–º–µ–Ω—å —Ç–æ—á–∏—Ç ‚Äî —Ä–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏ üíß",
    "–°–æ–º–Ω–µ–Ω–∏—è —É–±–∏–≤–∞—é—Ç –±–æ–ª—å—à–µ –º–µ—á—Ç–∞–Ω–∏–π, —á–µ–º –Ω–µ—É–¥–∞—á–∏ üé≠",
    "–ù–∞—á–Ω–∏ —Ç–∞–º, –≥–¥–µ —Ç—ã –µ—Å—Ç—å. –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ, —á—Ç–æ –∏–º–µ–µ—à—å üõ†Ô∏è"
]

# –°—Å—ã–ª–∫–∏ –Ω–∞ SportWiki –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–µ–º
SPORTWIKI_–°–°–´–õ–ö–ò = {
    '—Ç–∞–±–∞—Ç–∞': 'https://sportwiki.to/–¢–∞–±–∞—Ç–∞',
    'hiit': 'https://sportwiki.to/–í–ò–ò–¢',
    '—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞': 'https://sportwiki.to/–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞',
    '–ø–∏—Ç–∞–Ω–∏–µ': 'https://sportwiki.to/–°–ø–æ—Ä—Ç–∏–≤–Ω–æ–µ_–ø–∏—Ç–∞–Ω–∏–µ',
    '—Ä–µ—Ü–µ–ø—Ç': 'https://sportwiki.to/–°–ø–æ—Ä—Ç–∏–≤–Ω–∞—è_–¥–∏–µ—Ç–∞',
    '—É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ': 'https://sportwiki.to/–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è',
    '–ø—Ä–æ–≥—Ä–∞–º–º–∞': 'https://sportwiki.to/–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω–∞—è_–ø—Ä–æ–≥—Ä–∞–º–º–∞',
    '–Ω–∞—á–∏–Ω–∞—é—â–∏–π': 'https://sportwiki.to/–ù–æ–≤–∏—á–æ–∫',
    '—Å–∏–ª–∞': 'https://sportwiki.to/–°–∏–ª–∞',
    '–≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å': 'https://sportwiki.to/–í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å'
}


def –∑–∞–≥—Ä—É–∑–∏—Ç—å_—Å–æ—Å—Ç–æ—è–Ω–∏–µ():
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π update_id"""
    if STATE_FILE.exists():
        try:
            with open(STATE_FILE, 'r', encoding='utf-8') as f:
                data = json.load(f)
                return data.get('last_update_id', 0)
        except Exception as e:
            print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è: {e}")
    return 0


def —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å_—Å–æ—Å—Ç–æ—è–Ω–∏–µ(update_id):
    """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π update_id"""
    try:
        with open(STATE_FILE, 'w', encoding='utf-8') as f:
            json.dump({'last_update_id': update_id}, f, ensure_ascii=False, indent=2)
    except Exception as e:
        print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è: {e}")


def –ø–æ–ª—É—á–∏—Ç—å_–Ω–æ–≤—ã–µ_–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏(last_update_id):
    """
    –ü–æ–ª—É—á–∞–µ—Ç –Ω–æ–≤—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏–∑ Telegram –∫–∞–Ω–∞–ª–∞.
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç getUpdates –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –∫–∞–Ω–∞–ª–∞ –∏ –≥—Ä—É–ø–ø—ã –æ–±—Å—É–∂–¥–µ–Ω–∏–π.
    
    –í–ê–ñ–ù–û: –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ –∫ –ø–æ—Å—Ç–∞–º:
    1. –£ –∫–∞–Ω–∞–ª–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω–∞ –≥—Ä—É–ø–ø–∞ –æ–±—Å—É–∂–¥–µ–Ω–∏–π
    2. –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –≥—Ä—É–ø–ø—ã –æ–±—Å—É–∂–¥–µ–Ω–∏–π
    3. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –ø–æ—Å—Ç–∞–º –ø—Ä–∏—Ö–æ–¥—è—Ç –∫–∞–∫ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø—É –æ–±—Å—É–∂–¥–µ–Ω–∏–π
    """
    url = f"https://api.telegram.org/bot{TELEGRAM_BOT_TOKEN}/getUpdates"
    params = {
        'offset': last_update_id + 1,
        'timeout': 10,
        # –í–ê–ñ–ù–û: –ù–ï –≤–∫–ª—é—á–∞–µ–º 'channel_post' - –Ω–∞–º –Ω—É–∂–Ω—ã —Ç–æ–ª—å–∫–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –∞ –Ω–µ –ø–æ—Å—Ç—ã –∫–∞–Ω–∞–ª–∞!
        'allowed_updates': ['message']  # –¢–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –≥—Ä—É–ø–ø—ã –æ–±—Å—É–∂–¥–µ–Ω–∏–π
    }
    
    try:
        response = requests.get(url, params=params, timeout=15)
        if response.status_code != 200:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π: {response.status_code}")
            return [], last_update_id
        
        data = response.json()
        if not data.get('ok'):
            print(f"‚ùå Telegram API –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É: {data.get('description')}")
            return [], last_update_id
        
        updates = data.get('result', [])
        –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ = []
        max_update_id = last_update_id
        
        for update in updates:
            update_id = update.get('update_id', 0)
            max_update_id = max(max_update_id, update_id)
            
            # –í–ê–ñ–ù–û: –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –ø–æ—Å—Ç—ã –∏–∑ –∫–∞–Ω–∞–ª–∞ (channel_post) - —ç—Ç–æ –Ω–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏!
            if update.get('channel_post'):
                print(f"‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ—Å—Ç –∏–∑ –∫–∞–Ω–∞–ª–∞ (channel_post)")
                continue
            
            # –ü–æ–ª—É—á–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –∏–∑ –≥—Ä—É–ø–ø—ã –æ–±—Å—É–∂–¥–µ–Ω–∏–π –∏–ª–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏)
            message = update.get('message')
            if not message:
                continue
            
            # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –±–æ—Ç–∞
            if message.get('from', {}).get('is_bot'):
                continue
            
            chat = message.get('chat', {})
            chat_id = str(chat.get('id', ''))
            chat_type = chat.get('type', '')
            
            # –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ù–ï –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–æ—Å—Ç—ã –∏–∑ —Å–∞–º–æ–≥–æ –∫–∞–Ω–∞–ª–∞!
            # –ü–æ—Å—Ç—ã –∏–∑ –∫–∞–Ω–∞–ª–∞ –∏–º–µ—é—Ç chat_type='channel' –∏ chat_id == TELEGRAM_CHAT_ID
            # –ú—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¢–û–õ–¨–ö–û –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –ø–æ—Å—Ç–∞–º!
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ù–ï –ø–æ—Å—Ç –∏–∑ –∫–∞–Ω–∞–ª–∞
            if chat_type == 'channel' and chat_id == str(TELEGRAM_CHAT_ID):
                print(f"‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ—Å—Ç –∏–∑ –∫–∞–Ω–∞–ª–∞ (chat_type=channel)")
                continue
            
            # –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –ø–æ—Å—Ç–∞–º –ø—Ä–∏—Ö–æ–¥—è—Ç –∏–∑ –≥—Ä—É–ø–ø—ã –æ–±—Å—É–∂–¥–µ–Ω–∏–π (supergroup/group)
            # –ò –∏–º–µ—é—Ç reply_to_message, —É–∫–∞–∑—ã–≤–∞—é—â–µ–µ –Ω–∞ –ø–æ—Å—Ç –≤ –∫–∞–Ω–∞–ª–µ
            is_comment_to_post = False
            reply_to = message.get('reply_to_message')
            if reply_to:
                # –ï—Å–ª–∏ —ç—Ç–æ –æ—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –∫–∞–Ω–∞–ª–∞ - —ç—Ç–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –ø–æ—Å—Ç—É
                reply_chat = reply_to.get('chat', {})
                reply_chat_type = reply_chat.get('type', '')
                reply_chat_id = str(reply_chat.get('id', ''))
                
                # –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –ø–æ—Å—Ç—É: reply_to —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∫–∞–Ω–∞–ª
                if reply_chat_type == 'channel' and reply_chat_id == str(TELEGRAM_CHAT_ID):
                    is_comment_to_post = True
                    print(f"‚úÖ –ù–∞–π–¥–µ–Ω –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –ø–æ—Å—Ç—É (reply_to –∫–∞–Ω–∞–ª)")
            
            # –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –≥—Ä—É–ø–ø—ã –æ–±—Å—É–∂–¥–µ–Ω–∏–π (supergroup/group)
            is_from_discussion_group = chat_type in ['supergroup', 'group']
            
            # –ü—Ä–∏–Ω–∏–º–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¢–û–õ–¨–ö–û –µ—Å–ª–∏:
            # - –≠—Ç–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –ø–æ—Å—Ç—É (reply_to —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∫–∞–Ω–∞–ª), –ò–õ–ò
            # - –≠—Ç–æ –∏–∑ –≥—Ä—É–ø–ø—ã –æ–±—Å—É–∂–¥–µ–Ω–∏–π (supergroup/group) - –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –ø–æ—Å—Ç–∞–º
            # –ù–ï –ø—Ä–∏–Ω–∏–º–∞–µ–º –ø–æ—Å—Ç—ã –∏–∑ —Å–∞–º–æ–≥–æ –∫–∞–Ω–∞–ª–∞!
            if not (is_comment_to_post or is_from_discussion_group):
                print(f"‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞–µ–º: –Ω–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –ø–æ—Å—Ç—É (chat_type={chat_type}, chat_id={chat_id})")
                continue
            
            # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
            text = message.get('text') or message.get('caption', '')
            if not text or len(text.strip()) < MIN_QUESTION_LENGTH:
                continue
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–≤–æ–∑–º–æ–∂–Ω–æ —Å–ø–∞–º)
            if len(text) > MAX_QUESTION_LENGTH:
                continue
            
            –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏.append({
                'update_id': update_id,
                'message_id': message.get('message_id'),
                'text': text.strip(),
                'from_user': message.get('from', {}).get('first_name', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'),
                'date': message.get('date', 0),
                'is_comment': is_comment_to_post or is_from_discussion_group  # –§–ª–∞–≥, —á—Ç–æ —ç—Ç–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
            })
        
        return –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, max_update_id
        
    except Exception as e:
        print(f"‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤: {e}")
        return [], last_update_id


def —ç—Ç–æ_–≤–æ–ø—Ä–æ—Å(—Ç–µ–∫—Å—Ç):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–æ–º"""
    —Ç–µ–∫—Å—Ç_–Ω–∏–∂–Ω–∏–π = —Ç–µ–∫—Å—Ç.lower()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –≤–æ–ø—Ä–æ—Å–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∑–Ω–∞–∫–∞
    if '?' in —Ç–µ–∫—Å—Ç:
        return True
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤–æ–ø—Ä–æ—Å–æ–≤
    for keyword in QUESTION_KEYWORDS:
        if keyword in —Ç–µ–∫—Å—Ç_–Ω–∏–∂–Ω–∏–π:
            return True
    
    return False


def —ç—Ç–æ_—Å–ø–∞–º(—Ç–µ–∫—Å—Ç):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—Å—Ç —Å–ø–∞–º–æ–º"""
    —Ç–µ–∫—Å—Ç_–Ω–∏–∂–Ω–∏–π = —Ç–µ–∫—Å—Ç.lower()
    
    for spam_word in SPAM_KEYWORDS:
        if spam_word in —Ç–µ–∫—Å—Ç_–Ω–∏–∂–Ω–∏–π:
            return True
    
    return False


def –Ω—É–∂–Ω–æ_–æ—Ç–≤–µ—á–∞—Ç—å(—Ç–µ–∫—Å—Ç):
    """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –Ω—É–∂–Ω–æ –ª–∏ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"""
    if not —ç—Ç–æ_–≤–æ–ø—Ä–æ—Å(—Ç–µ–∫—Å—Ç):
        return False
    
    if —ç—Ç–æ_—Å–ø–∞–º(—Ç–µ–∫—Å—Ç):
        return False
    
    —Ç–µ–∫—Å—Ç_–Ω–∏–∂–Ω–∏–π = —Ç–µ–∫—Å—Ç.lower()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
    for trigger in AUTO_REPLY_TRIGGERS:
        if trigger in —Ç–µ–∫—Å—Ç_–Ω–∏–∂–Ω–∏–π:
            return True
    
    # –ï—Å–ª–∏ —ç—Ç–æ –≤–æ–ø—Ä–æ—Å –∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª–∏–Ω–Ω—ã–π - –≤–µ—Ä–æ—è—Ç–Ω–æ, —Å—Ç–æ–∏—Ç –æ—Ç–≤–µ—Ç–∏—Ç—å
    if len(—Ç–µ–∫—Å—Ç) >= 20:
        return True
    
    return False


def –ø–æ–ª—É—á–∏—Ç—å_—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é_—Å—Å—ã–ª–∫—É_sportwiki(–≤–æ–ø—Ä–æ—Å):
    """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ SportWiki –ø–æ –≤–æ–ø—Ä–æ—Å—É"""
    –≤–æ–ø—Ä–æ—Å_–Ω–∏–∂–Ω–∏–π = –≤–æ–ø—Ä–æ—Å.lower()
    for –∫–ª—é—á, —Å—Å—ã–ª–∫–∞ in SPORTWIKI_–°–°–´–õ–ö–ò.items():
        if –∫–ª—é—á in –≤–æ–ø—Ä–æ—Å_–Ω–∏–∂–Ω–∏–π:
            return —Å—Å—ã–ª–∫–∞
    return None


def –ø–æ–ª—É—á–∏—Ç—å_—Å–ª—É—á–∞–π–Ω—É—é_—Ñ—Ä–∞–∑—É():
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—É—é –∫–æ—Ä–æ—Ç–∫—É—é –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—É—é —Ñ—Ä–∞–∑—É"""
    return random.choice(–ú–û–¢–ò–í–ê–¶–ò–û–ù–ù–´–ï_–§–†–ê–ó–´)


def –ø–æ–ª—É—á–∏—Ç—å_—à—É—Ç–∫—É():
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—É—é —Ñ–∏—Ç–Ω–µ—Å-—à—É—Ç–∫—É"""
    —à—É—Ç–∫–∏ = [
        "–ü–æ–º–Ω–∏: –º—ã—à—Ü—ã —Ä–∞—Å—Ç—É—Ç –Ω–µ –≤ –∑–∞–ª–µ, –∞ –∫–æ–≥–¥–∞ —Ç—ã –¥—É–º–∞–µ—à—å –æ –Ω–∏—Ö –¥–æ–º–∞ üòÑ",
        "–û—Ç–∂–∏–º–∞–Ω–∏—è ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ —Ç—ã –ø–æ–¥–Ω–∏–º–∞–µ—à—å —Å–µ–±—è –æ—Ç –ø–æ–ª–∞, –∞ –Ω–µ –æ—Ç –¥–∏–≤–∞–Ω–∞ üòÇ",
        "–ë–µ–≥ ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ —Ç—ã —É–±–µ–≥–∞–µ—à—å –æ—Ç –ø—Ä–æ–±–ª–µ–º, –Ω–æ –æ–Ω–∏ –±–µ–≥—É—Ç –±—ã—Å—Ç—Ä–µ–µ üèÉ",
        "–ü–ª–∞–Ω–∫–∞ ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ –º–∏–Ω—É—Ç–∞ –∫–∞–∂–µ—Ç—Å—è –≤–µ—á–Ω–æ—Å—Ç—å—é, –Ω–æ —Ç—ã –≤—Å—ë —Ä–∞–≤–Ω–æ –¥–µ—Ä–∂–∏—à—å—Å—è üí™",
        "–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ —Ç–≤–æ–∏ –Ω–æ–≥–∏ –≥–æ–≤–æ—Ä—è—Ç '—Å—Ç–æ–ø', –∞ —Ç—ã –≥–æ–≤–æ—Ä–∏—à—å '–µ—â—ë 5' üòÖ",
        "–ö–∞—Ä–¥–∏–æ ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ —Ç—ã –ø–æ—Ç–µ–µ—à—å, –Ω–æ –∑–Ω–∞–µ—à—å, —á—Ç–æ —ç—Ç–æ –∫—Ä–∞—Å–∏–≤–æ –≤—ã–≥–ª—è–¥–∏—Ç üî•",
        "–†–∞—Å—Ç—è–∂–∫–∞ ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ —Ç—ã –ø–æ–Ω–∏–º–∞–µ—à—å, —á—Ç–æ –Ω–µ —Ç–∞–∫–æ–π –≥–∏–±–∫–∏–π, –∫–∞–∫ –¥—É–º–∞–ª ü§∏",
        "–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ —Ç—ã –∂–∞–ª—É–µ—à—å—Å—è, –Ω–æ –≤—Å—ë —Ä–∞–≤–Ω–æ –∏–¥—ë—à—å –∑–∞–≤—Ç—Ä–∞ üòÑ",
        "–ñ–∏–º –ª—ë–∂–∞ ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ —à—Ç–∞–Ω–≥–∞ –∫–∞–∂–µ—Ç—Å—è –ª–µ–≥—á–µ –≤ –≥–æ–ª–æ–≤–µ, —á–µ–º –≤ —Ä—É–∫–∞—Ö üòÇ",
        "–ô–æ–≥–∞ ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ —Ç—ã –ø—ã—Ç–∞–µ—à—å—Å—è –±—ã—Ç—å —Å–ø–æ–∫–æ–π–Ω—ã–º, –Ω–æ –º—ã—à—Ü—ã –∫—Ä–∏—á–∞—Ç üßò"
    ]
    return random.choice(—à—É—Ç–∫–∏)


def —ç—Ç–æ_–æ—Ç–∑—ã–≤_–ø—Ä–æ_—Ç–∞–π–º–µ—Ä(—Ç–µ–∫—Å—Ç):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–æ–º/–≤–æ–ø—Ä–æ—Å–æ–º –ø—Ä–æ —Ç–∞–π–º–µ—Ä/—Å–∞–π—Ç"""
    —Ç–µ–∫—Å—Ç_–Ω–∏–∂–Ω–∏–π = —Ç–µ–∫—Å—Ç.lower()
    
    for –∫–ª—é—á in –¢–ê–ô–ú–ï–†_–ö–õ–Æ–ß–ï–í–´–ï_–°–õ–û–í–ê:
        if –∫–ª—é—á in —Ç–µ–∫—Å—Ç_–Ω–∏–∂–Ω–∏–π:
            return True
    
    return False


def —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å_–æ—Ç–∑—ã–≤_–≤_markdown(–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, –æ—Ç–≤–µ—Ç_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é):
    """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—Ç–∑—ã–≤ –æ —Ç–∞–π–º–µ—Ä–µ –≤ markdown —Ñ–∞–π–ª"""
    try:
        # –°–æ–∑–¥–∞—ë–º –∑–∞–≥–æ–ª–æ–≤–æ–∫, –µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        if not FEEDBACK_FILE.exists():
            with open(FEEDBACK_FILE, 'w', encoding='utf-8') as f:
                f.write("# üìù –û—Ç–∑—ã–≤—ã –∏ –∑–∞–º–µ—á–∞–Ω–∏—è –æ —Ç–∞–π–º–µ—Ä–µ tabatatimer.ru\n\n")
                f.write("> –≠—Ç–æ—Ç —Ñ–∞–π–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞–µ—Ç –æ—Ç–∑—ã–≤—ã, –∑–∞–º–µ—á–∞–Ω–∏—è –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ—Ç –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –∫–∞–Ω–∞–ª–∞.\n\n")
                f.write("---\n\n")
        
        # –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –æ—Ç–∑—ã–≤
        with open(FEEDBACK_FILE, 'a', encoding='utf-8') as f:
            f.write(f"## {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n\n")
            f.write(f"**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** {–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π.get('from_user', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')}\n\n")
            f.write(f"**–°–æ–æ–±—â–µ–Ω–∏–µ:**\n> {–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π.get('text', '')}\n\n")
            f.write(f"**–û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:**\n> {–æ—Ç–≤–µ—Ç_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é}\n\n")
            f.write("---\n\n")
        
        print(f"‚úÖ –û—Ç–∑—ã–≤ —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ {FEEDBACK_FILE}")
        return True
    except Exception as e:
        print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç–∑—ã–≤–∞: {e}")
        return False


def –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å_–æ—Ç–∑—ã–≤_–∏_–ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å_—Ä–µ—à–µ–Ω–∏–µ(–æ—Ç–∑—ã–≤):
    """
    –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ—Ç–∑—ã–≤ —á–µ—Ä–µ–∑ DeepSeek –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ/—É–ª—É—á—à–µ–Ω–∏–µ
    """
    —Å–∏—Å—Ç–µ–º–Ω–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ = """–ê–Ω–∞–ª–∏—Ç–∏–∫ UX. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –æ—Ç–∑—ã–≤ –æ tabatatimer.ru. –§–æ—Ä–º–∞—Ç: 1. –ü—Ä–æ–±–ª–µ–º–∞ (–∫—Ä–∞—Ç–∫–æ), 2. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–≤—ã—Å–æ–∫–∏–π/—Å—Ä–µ–¥–Ω–∏–π/–Ω–∏–∑–∫–∏–π), 3. –†–µ—à–µ–Ω–∏–µ (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —à–∞–≥–∏), 4. –î–æ–ø. –∏–¥–µ–∏. –ë—É–¥—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º."""

    –ø—Ä–æ–º–ø—Ç = f"""–û—Ç–∑—ã–≤ –æ tabatatimer.ru: "{–æ—Ç–∑—ã–≤}". –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∏ –ø—Ä–µ–¥–ª–æ–∂–∏ —Ä–µ—à–µ–Ω–∏–µ."""

    try:
        response = requests.post(
            "https://api.deepseek.com/v1/chat/completions",
            headers={
                "Authorization": f"Bearer {DEEPSEEK_API_KEY}",
                "Content-Type": "application/json"
            },
            json={
                "model": "deepseek-chat",
                "messages": [
                    {"role": "system", "content": —Å–∏—Å—Ç–µ–º–Ω–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ},
                    {"role": "user", "content": –ø—Ä–æ–º–ø—Ç}
                ],
                "temperature": 0.7,
                "max_tokens": 350  # –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤
            },
            timeout=30
        )
        
        if response.status_code == 200:
            data = response.json()
            –∞–Ω–∞–ª–∏–∑ = data['choices'][0]['message']['content'].strip()
            return –∞–Ω–∞–ª–∏–∑
        else:
            print(f"‚ùå –û—à–∏–±–∫–∞ DeepSeek API –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ: {response.status_code}")
            return None
            
    except Exception as e:
        print(f"‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ –æ—Ç–∑—ã–≤–∞: {e}")
        return None


def –¥–æ–±–∞–≤–∏—Ç—å_–∞–Ω–∞–ª–∏–∑_–≤_markdown(–∞–Ω–∞–ª–∏–∑):
    """–î–æ–±–∞–≤–ª—è–µ—Ç –∞–Ω–∞–ª–∏–∑ –æ—Ç DeepSeek –≤ markdown —Ñ–∞–π–ª"""
    try:
        if not FEEDBACK_FILE.exists():
            return False
        
        # –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª
        with open(FEEDBACK_FILE, 'r', encoding='utf-8') as f:
            —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ = f.read()
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∞–ª–∏–∑ –≤ –∫–æ–Ω–µ—Ü –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ—Ç–∑—ã–≤–∞
        if "---\n\n" in —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ:
            # –ù–∞—Ö–æ–¥–∏–º –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –∏ –¥–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∞–ª–∏–∑ –ø–µ—Ä–µ–¥ –Ω–∏–º
            —á–∞—Å—Ç–∏ = —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ.rsplit("---\n\n", 1)
            if len(—á–∞—Å—Ç–µ–π) == 2:
                –Ω–æ–≤—ã–π_–∫–æ–Ω—Ç–µ–Ω—Ç = —á–∞—Å—Ç–∏[0] + f"\n**ü§ñ –ê–Ω–∞–ª–∏–∑ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:**\n\n{–∞–Ω–∞–ª–∏–∑}\n\n---\n\n" + —á–∞—Å—Ç–∏[1]
                
                with open(FEEDBACK_FILE, 'w', encoding='utf-8') as f:
                    f.write(–Ω–æ–≤—ã–π_–∫–æ–Ω—Ç–µ–Ω—Ç)
                
                print("‚úÖ –ê–Ω–∞–ª–∏–∑ –¥–æ–±–∞–≤–ª–µ–Ω –≤ markdown")
                return True
        
        return False
    except Exception as e:
        print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞: {e}")
        return False


def —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å_–æ—Ç–≤–µ—Ç_–Ω–∞_–æ—Ç–∑—ã–≤(–æ—Ç–∑—ã–≤):
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω–∞ –æ—Ç–∑—ã–≤ –æ —Ç–∞–π–º–µ—Ä–µ"""
    —Å–∏—Å—Ç–µ–º–Ω–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ = """–ü–æ–º–æ—â–Ω–∏–∫ @fitnesstimer. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–≤–∏–ª –æ—Ç–∑—ã–≤ –æ —Ç–∞–π–º–µ—Ä–µ. –û—Ç–≤–µ—Ç—å –¥—Ä—É–∂–µ–ª—é–±–Ω–æ: –æ—Ç–∑—ã–≤ –ø—Ä–∏–Ω—è—Ç, –±—É–¥–µ–º —É—Å—Ç—Ä–∞–Ω—è—Ç—å/–¥–æ—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å, –±–ª–∞–≥–æ–¥–∞—Ä–∏ –∑–∞ –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å. 100-200 —Å–∏–º–≤–æ–ª–æ–≤. –ü–æ–∑–∏—Ç–∏–≤–Ω–æ."""

    –ø—Ä–æ–º–ø—Ç = f"""–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–ø–∏—Å–∞–ª:

"{–æ—Ç–∑—ã–≤}"

–°—Ñ–æ—Ä–º–∏—Ä—É–π –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –æ—Ç–≤–µ—Ç, —á—Ç–æ –æ—Ç–∑—ã–≤ –ø—Ä–∏–Ω—è—Ç –∫ —Å–≤–µ–¥–µ–Ω–∏—é –∏ –±—É–¥–µ—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω."""

    try:
        response = requests.post(
            "https://api.deepseek.com/v1/chat/completions",
            headers={
                "Authorization": f"Bearer {DEEPSEEK_API_KEY}",
                "Content-Type": "application/json"
            },
            json={
                "model": "deepseek-chat",
                "messages": [
                    {"role": "system", "content": —Å–∏—Å—Ç–µ–º–Ω–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ},
                    {"role": "user", "content": –ø—Ä–æ–º–ø—Ç}
                ],
                "temperature": 0.8,
                "max_tokens": 200
            },
            timeout=20
        )
        
        if response.status_code == 200:
            data = response.json()
            –æ—Ç–≤–µ—Ç = data['choices'][0]['message']['content'].strip()
            return –æ—Ç–≤–µ—Ç
        else:
            # –§–æ–ª–±—ç–∫ –æ—Ç–≤–µ—Ç
            return "–°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ç–∑—ã–≤! –ü—Ä–∏–Ω—è—Ç–æ –∫ —Å–≤–µ–¥–µ–Ω–∏—é, –±—É–¥–µ–º —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–¥ —É–ª—É—á—à–µ–Ω–∏—è–º–∏ üí™"
            
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –æ—Ç–∑—ã–≤: {e}")
        return "–°–ø–∞—Å–∏–±–æ –∑–∞ –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å! –ü—Ä–∏–Ω—è—Ç–æ –∫ —Å–≤–µ–¥–µ–Ω–∏—é, –±—É–¥–µ–º –¥–æ—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å üîß"


def –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å_—Å—Ç–∏–ª—å_–æ—Ç–≤–µ—Ç–∞(–≤–æ–ø—Ä–æ—Å):
    """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ç–∏–ª—å –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–ø—Ä–æ—Å–∞"""
    –≤–æ–ø—Ä–æ—Å_–Ω–∏–∂–Ω–∏–π = –≤–æ–ø—Ä–æ—Å.lower()
    
    # –£—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã (–µ—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –∫–æ—Ä–æ—Ç–∫–∏–π –∏–ª–∏ –Ω–µ—è—Å–Ω—ã–π)
    if len(–≤–æ–ø—Ä–æ—Å) < 30 or any(word in –≤–æ–ø—Ä–æ—Å_–Ω–∏–∂–Ω–∏–π for word in ['—á—Ç–æ', '–∫–∞–∫–æ–π', '–∫–∞–∫–∞—è', '–∫–∞–∫–æ–µ']):
        if random.random() < 0.4:  # 40% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É—Ç–æ—á–Ω—è—é—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
            return '—É—Ç–æ—á–Ω—è—é—â–∏–π'
    
    # –ö–æ—Ä–æ—Ç–∫–∏–µ –æ—Ç–≤–µ—Ç—ã (–¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤)
    if len(–≤–æ–ø—Ä–æ—Å) < 50 and any(word in –≤–æ–ø—Ä–æ—Å_–Ω–∏–∂–Ω–∏–π for word in ['–¥–∞', '–Ω–µ—Ç', '–º–æ–∂–Ω–æ', '–Ω—É–∂–Ω–æ']):
        if random.random() < 0.5:  # 50% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∫–æ—Ä–æ—Ç–∫–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
            return '–∫–æ—Ä–æ—Ç–∫–∏–π'
    
    # –°–æ–≥–ª–∞—Å–∏–µ –∏ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ (–µ—Å–ª–∏ —á–µ–ª–æ–≤–µ–∫ –≤—ã—Å–∫–∞–∑—ã–≤–∞–µ—Ç –º–Ω–µ–Ω–∏–µ)
    if any(word in –≤–æ–ø—Ä–æ—Å_–Ω–∏–∂–Ω–∏–π for word in ['–¥—É–º–∞—é', '—Å—á–∏—Ç–∞—é', '–º–Ω–µ –∫–∞–∂–µ—Ç—Å—è', '—è –¥—É–º–∞—é', '–ø–æ-–º–æ–µ–º—É']):
        if random.random() < 0.6:  # 60% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Å–æ–≥–ª–∞—Å–∏—è
            return '—Å–æ–≥–ª–∞—Å–∏–µ'
    
    # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é - —Å—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç
    return '—Å—Ä–µ–¥–Ω–∏–π'


def —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å_–æ—Ç–≤–µ—Ç(–≤–æ–ø—Ä–æ—Å):
    """
    –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∂–∏–≤–æ–π, –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–π –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å —á–µ—Ä–µ–∑ DeepSeek AI
    —Å —Ä–∞–∑–Ω—ã–º–∏ —Å—Ç–∏–ª—è–º–∏: –∫–æ—Ä–æ—Ç–∫–∏–π, —Å—Ä–µ–¥–Ω–∏–π, —É—Ç–æ—á–Ω—è—é—â–∏–π, —Å–æ–≥–ª–∞—Å–∏–µ
    """
    —Å—Ç–∏–ª—å = –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å_—Å—Ç–∏–ª—å_–æ—Ç–≤–µ—Ç–∞(–≤–æ–ø—Ä–æ—Å)
    
    —Å–∏—Å—Ç–µ–º–Ω–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ = """–¢—ã - –∂–∏–≤–æ–π, –≤–µ—Å—ë–ª—ã–π –ø–æ–º–æ—â–Ω–∏–∫ —Ñ–∏—Ç–Ω–µ—Å-–∫–∞–Ω–∞–ª–∞ @fitnesstimer. 
–°—Ç–∏–ª—å: –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π, —ç–Ω–µ—Ä–≥–∏—á–Ω—ã–π, —Å —é–º–æ—Ä–æ–º. –û—Ç–º–µ—á–∞–π –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –º—ã—Å–ª–∏, —Å–æ–≥–ª–∞—à–∞–π—Å—è –∏ –¥–æ–ø–æ–ª–Ω—è–π. –û—Ç–≤–µ—á–∞–π –ø—Ä—è–º–æ –Ω–∞ –≤–æ–ø—Ä–æ—Å, –¥–∞–≤–∞–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ—É. –ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏ —É–º–µ—Ä–µ–Ω–Ω–æ. –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑—å –¥–ª–∏–Ω—É –æ—Ç–≤–µ—Ç–æ–≤ (50-500 —Å–∏–º–≤–æ–ª–æ–≤). –®—É—Ç–∏ –ø–æ—á–∞—â–µ, –Ω–æ –ø–æ –¥–µ–ª—É."""

    # –ü–æ–ª—É—á–∞–µ–º —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ SportWiki
    sportwiki_—Å—Å—ã–ª–∫–∞ = –ø–æ–ª—É—á–∏—Ç—å_—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é_—Å—Å—ã–ª–∫—É_sportwiki(–≤–æ–ø—Ä–æ—Å)
    sportwiki_—á–∞—Å—Ç—å = ""
    if sportwiki_—Å—Å—ã–ª–∫–∞:
        sportwiki_—á–∞—Å—Ç—å = f"\n\nüìö –ù–∞—É—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ —Ç–µ–º–µ: {sportwiki_—Å—Å—ã–ª–∫–∞}"
    
    # –ü–æ–ª—É—á–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—É—é —Ñ—Ä–∞–∑—É (—Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é 40%)
    —Ñ—Ä–∞–∑–∞_—á–∞—Å—Ç—å = ""
    if random.random() < 0.4:
        —Ñ—Ä–∞–∑–∞_—á–∞—Å—Ç—å = f"\n\nüí¨ {–ø–æ–ª—É—á–∏—Ç—å_—Å–ª—É—á–∞–π–Ω—É—é_—Ñ—Ä–∞–∑—É()}"
    
    # –ü–æ–ª—É—á–∞–µ–º —à—É—Ç–∫—É (—Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é 50% - —à—É—Ç–∏–º –ø–æ—á–∞—â–µ!)
    —à—É—Ç–∫–∞_—á–∞—Å—Ç—å = ""
    if random.random() < 0.5:
        —à—É—Ç–∫–∞_—á–∞—Å—Ç—å = f"\n\nüòÑ {–ø–æ–ª—É—á–∏—Ç—å_—à—É—Ç–∫—É()}"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ —É–ø–æ–º—è–Ω—É—Ç—å –æ—Ñ—Ñ–µ—Ä (–Ω–µ–Ω–∞–≤—è–∑—á–∏–≤–æ, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ)
    –æ—Ñ—Ñ–µ—Ä_—á–∞—Å—Ç—å = ""
    –≤–æ–ø—Ä–æ—Å_–Ω–∏–∂–Ω–∏–π = –≤–æ–ø—Ä–æ—Å.lower()
    if any(word in –≤–æ–ø—Ä–æ—Å_–Ω–∏–∂–Ω–∏–π for word in ['–ø—Ä–æ–≥—Ä–∞–º–º–∞', '–∫—É—Ä—Å', '–æ–±—É—á–µ–Ω–∏–µ', '–ø–æ–º–æ—â—å', '—Ä–µ–∑—É–ª—å—Ç–∞—Ç', '—É—Å–ø–µ—Ö']):
        –æ—Ñ—Ñ–µ—Ä_—á–∞—Å—Ç—å = "\n\nüéØ –ö—Å—Ç–∞—Ç–∏, —É –Ω–∞—Å –µ—Å—Ç—å –∫—Ä—É—Ç—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–π! –ü–æ–¥—Ä–æ–±–Ω–µ–µ: https://telegra.ph/OFFER-NA-MILLIARD-07-08"
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∏–ª—è
    if —Å—Ç–∏–ª—å == '—É—Ç–æ—á–Ω—è—é—â–∏–π':
        –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è = "–ó–∞–¥–∞–π –∫–æ—Ä–æ—Ç–∫–∏–π —É—Ç–æ—á–Ω—è—é—â–∏–π –≤–æ–ø—Ä–æ—Å, —á—Ç–æ–±—ã –ª—É—á—à–µ –ø–æ–Ω—è—Ç—å, —á—Ç–æ —á–µ–ª–æ–≤–µ–∫ –∏–º–µ–µ—Ç –≤ –≤–∏–¥—É. –ë—É–¥—å –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º –∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º."
        –º–∞–∫—Å_—Å–∏–º–≤–æ–ª–æ–≤ = "50-100"
    elif —Å—Ç–∏–ª—å == '–∫–æ—Ä–æ—Ç–∫–∏–π':
        –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è = "–î–∞–π –∫–æ—Ä–æ—Ç–∫–∏–π, –Ω–æ –ø–æ–ª–µ–∑–Ω—ã–π –æ—Ç–≤–µ—Ç. –ë—É–¥—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∏ –ø–æ –¥–µ–ª—É."
        –º–∞–∫—Å_—Å–∏–º–≤–æ–ª–æ–≤ = "100-150"
    elif —Å—Ç–∏–ª—å == '—Å–æ–≥–ª–∞—Å–∏–µ':
        –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è = "–û—Ç–º–µ—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –º—ã—Å–ª–∏ —á–µ–ª–æ–≤–µ–∫–∞, —Å–æ–≥–ª–∞—Å–∏—Å—å —Å –Ω–∏–º –∏ –¥–æ–ø–æ–ª–Ω–∏ –µ–≥–æ –º—ã—Å–ª—å –ø–æ–ª–µ–∑–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π. –ë—É–¥—å –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–º."
        –º–∞–∫—Å_—Å–∏–º–≤–æ–ª–æ–≤ = "200-350"
    else:  # —Å—Ä–µ–¥–Ω–∏–π
        –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è = "–î–∞–π —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã–π, –Ω–æ –Ω–µ –∑–∞–Ω—É–¥–Ω—ã–π –æ—Ç–≤–µ—Ç. –û—Ç–≤–µ—á–∞–π –ø—Ä—è–º–æ –Ω–∞ –≤–æ–ø—Ä–æ—Å, –¥–∞–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ—É –¥–ª—è —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è."
        –º–∞–∫—Å_—Å–∏–º–≤–æ–ª–æ–≤ = "250-450"
    
    –ø—Ä–æ–º–ø—Ç = f"""–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–ø–∏—Å–∞–ª –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö –∫ –ø–æ—Å—Ç—É –≤ —Ñ–∏—Ç–Ω–µ—Å-–∫–∞–Ω–∞–ª–µ:

"{–≤–æ–ø—Ä–æ—Å}"

–°–¢–ò–õ–¨ –û–¢–í–ï–¢–ê: {—Å—Ç–∏–ª—å}
–ò–ù–°–¢–†–£–ö–¶–ò–Ø: {–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è}
–ú–ê–ö–°–ò–ú–ê–õ–¨–ù–ê–Ø –î–õ–ò–ù–ê: {–º–∞–∫—Å_—Å–∏–º–≤–æ–ª–æ–≤} —Å–∏–º–≤–æ–ª–æ–≤

–í–ê–ñ–ù–û:
- –û—Ç–º–µ—á–∞–π –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –º—ã—Å–ª–∏ —á–µ–ª–æ–≤–µ–∫–∞, –µ—Å–ª–∏ –æ–Ω –ø—Ä–∞–≤
- –û—Ç–≤–µ—á–∞–π –ø—Ä—è–º–æ –Ω–∞ –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π –≤–æ–ø—Ä–æ—Å
- –î–∞–≤–∞–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ—É –¥–ª—è —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è
- –®—É—Ç–∏ –ø–æ—á–∞—â–µ (–ª—ë–≥–∫–∏–π —é–º–æ—Ä, –ø–æ –¥–µ–ª—É)
- –ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –ø—Ä–æ —Ç–∞–π–º–µ—Ä tabatatimer.ru - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–ø–æ–º—è–Ω–∏ —Å—Å—ã–ª–∫—É https://tabatatimer.ru/#timer
- –ë—É–¥—å —ç–Ω–µ—Ä–≥–∏—á–Ω—ã–º –∏ –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–º
- –ï—Å–ª–∏ —á–µ–ª–æ–≤–µ–∫ —Å–æ–º–Ω–µ–≤–∞–µ—Ç—Å—è - –ø–æ–¥–±–æ–¥—Ä–∏ –µ–≥–æ!

{sportwiki_—á–∞—Å—Ç—å}{—Ñ—Ä–∞–∑–∞_—á–∞—Å—Ç—å}{—à—É—Ç–∫–∞_—á–∞—Å—Ç—å}{–æ—Ñ—Ñ–µ—Ä_—á–∞—Å—Ç—å}

–°—Ñ–æ—Ä–º–∏—Ä—É–π –æ—Ç–≤–µ—Ç –≤ –¥—Ä—É–∂–µ–ª—é–±–Ω–æ–º, –∂–∏–≤–æ–º —Å—Ç–∏–ª–µ, –∫–∞–∫ –ª—É—á—à–∏–π –¥—Ä—É–≥ –≤ —Å–ø–æ—Ä—Ç–∑–∞–ª–µ."""

    try:
        response = requests.post(
            "https://api.deepseek.com/v1/chat/completions",
            headers={
                "Authorization": f"Bearer {DEEPSEEK_API_KEY}",
                "Content-Type": "application/json"
            },
            json={
                "model": "deepseek-chat",
                "messages": [
                    {"role": "system", "content": —Å–∏—Å—Ç–µ–º–Ω–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ},
                    {"role": "user", "content": –ø—Ä–æ–º–ø—Ç}
                ],
                "temperature": 0.9,  # –í—ã—Å–æ–∫–∞—è –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è –∏ –∂–∏–≤—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
                "max_tokens": 350  # –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤, –Ω–æ —ç–∫–æ–Ω–æ–º–∏—Ç —Ç–æ–∫–µ–Ω—ã
            },
            timeout=20
        )
        
        if response.status_code == 200:
            data = response.json()
            –æ—Ç–≤–µ—Ç = data['choices'][0]['message']['content'].strip()
            
            # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É –æ—Ç–≤–µ—Ç–∞ (Telegram –ª–∏–º–∏—Ç –¥–ª—è –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è ~4096 —Å–∏–º–≤–æ–ª–æ–≤)
            # –ù–æ –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ª—É—á—à–µ –∫–æ—Ä–æ—á–µ - –¥–æ 600 —Å–∏–º–≤–æ–ª–æ–≤ (—Å —É—á—ë—Ç–æ–º —ç–º–æ–¥–∑–∏ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
            if len(–æ—Ç–≤–µ—Ç) > 600:
                –æ—Ç–≤–µ—Ç = –æ—Ç–≤–µ—Ç[:597] + "..."
            
            return –æ—Ç–≤–µ—Ç
        else:
            print(f"‚ùå –û—à–∏–±–∫–∞ DeepSeek API: {response.status_code}")
            return None
            
    except Exception as e:
        print(f"‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞: {e}")
        return None


def –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_–æ—Ç–≤–µ—Ç(message_id, –æ—Ç–≤–µ—Ç):
    """
    –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ Telegram
    """
    url = f"https://api.telegram.org/bot{TELEGRAM_BOT_TOKEN}/sendMessage"
    
    # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç: —É–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–π –ø—Ä–µ—Ñ–∏–∫—Å, –µ—Å–ª–∏ –æ–Ω —É–∂–µ –µ—Å—Ç—å
    if –æ—Ç–≤–µ—Ç.startswith("üí¨"):
        —Ç–µ–∫—Å—Ç_–æ—Ç–≤–µ—Ç–∞ = –æ—Ç–≤–µ—Ç
    else:
        —Ç–µ–∫—Å—Ç_–æ—Ç–≤–µ—Ç–∞ = f"üí¨ {–æ—Ç–≤–µ—Ç}"
    
    params = {
        'chat_id': TELEGRAM_CHAT_ID,
        'text': —Ç–µ–∫—Å—Ç_–æ—Ç–≤–µ—Ç–∞,
        'reply_to_message_id': message_id,
        'parse_mode': 'HTML',
        'disable_web_page_preview': False  # –†–∞–∑—Ä–µ—à–∞–µ–º –ø—Ä–µ–≤—å—é —Å—Å—ã–ª–æ–∫
    }
    
    try:
        response = requests.post(url, json=params, timeout=10)
        if response.status_code == 200:
            return True
        else:
            print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞: {response.status_code}")
            print(f"–û—Ç–≤–µ—Ç API: {response.text}")
            return False
    except Exception as e:
        print(f"‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ—Ç–≤–µ—Ç–∞: {e}")
        return False


def –≥–ª–∞–≤–Ω–∞—è():
    """
    –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –Ω–∏—Ö
    """
    if not all([TELEGRAM_BOT_TOKEN, TELEGRAM_CHAT_ID, DEEPSEEK_API_KEY]):
        print("‚ùå –ù–µ –∑–∞–¥–∞–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è")
        print("–ù—É–∂–Ω—ã: TELEGRAM_BOT_TOKEN, TELEGRAM_CHAT_ID, DEEPSEEK_API_KEY")
        return False
    
    print("ü§ñ –ó–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤...")
    
    # –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    last_update_id = –∑–∞–≥—Ä—É–∑–∏—Ç—å_—Å–æ—Å—Ç–æ—è–Ω–∏–µ()
    print(f"üìå –ü–æ—Å–ª–µ–¥–Ω–∏–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π update_id: {last_update_id}")
    
    # –ü–æ–ª—É—á–∞–µ–º –Ω–æ–≤—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
    –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –Ω–æ–≤—ã–π_update_id = –ø–æ–ª—É—á–∏—Ç—å_–Ω–æ–≤—ã–µ_–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏(last_update_id)
    
    if not –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:
        print("‚úÖ –ù–æ–≤—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –Ω–µ—Ç")
        if –Ω–æ–≤—ã–π_update_id > last_update_id:
            —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å_—Å–æ—Å—Ç–æ—è–Ω–∏–µ(–Ω–æ–≤—ã–π_update_id)
        return True
    
    print(f"üì® –ù–∞–π–¥–µ–Ω–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤: {len(–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏)}")
    
    –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ = 0
    –æ—Ç–≤–µ—á–µ–Ω–æ = 0
    –æ—Ç–∑—ã–≤–æ–≤_—Å–æ–±—Ä–∞–Ω–æ = 0
    
    for –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π in –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:
        –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ += 1
        —Ç–µ–∫—Å—Ç = –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π['text']
        message_id = –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π['message_id']
        –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π['from_user']
        
        print(f"\nüí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç {–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å}: {—Ç–µ–∫—Å—Ç[:50]}...")
        
        # –ü–†–û–í–ï–†–ö–ê: —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –æ—Ç–∑—ã–≤–æ–º/–≤–æ–ø—Ä–æ—Å–æ–º –ø—Ä–æ —Ç–∞–π–º–µ—Ä/—Å–∞–π—Ç?
        if —ç—Ç–æ_–æ—Ç–∑—ã–≤_–ø—Ä–æ_—Ç–∞–π–º–µ—Ä(—Ç–µ–∫—Å—Ç):
            print("üéØ –û–±–Ω–∞—Ä—É–∂–µ–Ω –æ—Ç–∑—ã–≤/–∑–∞–º–µ—á–∞–Ω–∏–µ –ø—Ä–æ —Ç–∞–π–º–µ—Ä/—Å–∞–π—Ç!")
            
            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
            –æ—Ç–≤–µ—Ç_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é = —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å_–æ—Ç–≤–µ—Ç_–Ω–∞_–æ—Ç–∑—ã–≤(—Ç–µ–∫—Å—Ç)
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–∑—ã–≤ –≤ markdown
            if —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å_–æ—Ç–∑—ã–≤_–≤_markdown(–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, –æ—Ç–≤–µ—Ç_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é):
                –æ—Ç–∑—ã–≤–æ–≤_—Å–æ–±—Ä–∞–Ω–æ += 1
                
                # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –æ—Ç–∑—ã–≤ —á–µ—Ä–µ–∑ DeepSeek –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º —Ä–µ—à–µ–Ω–∏–µ
                print("ü§ñ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –æ—Ç–∑—ã–≤ –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º —Ä–µ—à–µ–Ω–∏–µ...")
                –∞–Ω–∞–ª–∏–∑ = –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å_–æ—Ç–∑—ã–≤_–∏_–ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å_—Ä–µ—à–µ–Ω–∏–µ(—Ç–µ–∫—Å—Ç)
                
                if –∞–Ω–∞–ª–∏–∑:
                    –¥–æ–±–∞–≤–∏—Ç—å_–∞–Ω–∞–ª–∏–∑_–≤_markdown(–∞–Ω–∞–ª–∏–∑)
                    print("‚úÖ –ê–Ω–∞–ª–∏–∑ –¥–æ–±–∞–≤–ª–µ–Ω –≤ markdown")
            
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
            if –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_–æ—Ç–≤–µ—Ç(message_id, –æ—Ç–≤–µ—Ç_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é):
                –æ—Ç–≤–µ—á–µ–Ω–æ += 1
                print("‚úÖ –û—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!")
            else:
                print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç")
            
            continue
        
        # –û–±—ã—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ (–Ω–µ –ø—Ä–æ —Ç–∞–π–º–µ—Ä)
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –æ—Ç–≤–µ—á–∞—Ç—å
        if not –Ω—É–∂–Ω–æ_–æ—Ç–≤–µ—á–∞—Ç—å(—Ç–µ–∫—Å—Ç):
            print("‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞–µ–º (–Ω–µ –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –Ω–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ)")
            continue
        
        print("ü§ñ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ DeepSeek...")
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç
        –æ—Ç–≤–µ—Ç = —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å_–æ—Ç–≤–µ—Ç(—Ç–µ–∫—Å—Ç)
        
        if not –æ—Ç–≤–µ—Ç:
            print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç")
            continue
        
        print(f"‚úÖ –û—Ç–≤–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω: {–æ—Ç–≤–µ—Ç[:50]}...")
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç
        if –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_–æ—Ç–≤–µ—Ç(message_id, –æ—Ç–≤–µ—Ç):
            –æ—Ç–≤–µ—á–µ–Ω–æ += 1
            print("‚úÖ –û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!")
        else:
            print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç")
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    if –Ω–æ–≤—ã–π_update_id > last_update_id:
        —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å_—Å–æ—Å—Ç–æ—è–Ω–∏–µ(–Ω–æ–≤—ã–π_update_id)
    
    print(f"\nüìä –ò—Ç–æ–≥–æ: –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ {–æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ}, –æ—Ç–≤–µ—á–µ–Ω–æ {–æ—Ç–≤–µ—á–µ–Ω–æ}, –æ—Ç–∑—ã–≤–æ–≤ —Å–æ–±—Ä–∞–Ω–æ {–æ—Ç–∑—ã–≤–æ–≤_—Å–æ–±—Ä–∞–Ω–æ}")
    
    if –æ—Ç–∑—ã–≤–æ–≤_—Å–æ–±—Ä–∞–Ω–æ > 0:
        print(f"\nüìù –û—Ç–∑—ã–≤—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ {FEEDBACK_FILE}")
        print("üí° –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –ø–æ —É–ª—É—á—à–µ–Ω–∏—é!")
    
    return True


if __name__ == "__main__":
    —É—Å–ø–µ—Ö = –≥–ª–∞–≤–Ω–∞—è()
    exit(0 if —É—Å–ø–µ—Ö else 1)


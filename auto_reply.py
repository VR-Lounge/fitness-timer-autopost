#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
    –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–≤–µ—Ç –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ Telegram
    
    –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ–¥ –ø–æ—Å—Ç–∞–º–∏ —á–µ—Ä–µ–∑ DeepSeek AI
    –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —á–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã.
    
    –ê–≤—Ç–æ—Ä: VR-Lounge
    –ö–∞–Ω–∞–ª: @fitnesstimer
"""

import os
import requests
import json
import re
from datetime import datetime
from pathlib import Path

# ============= –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø =============

TELEGRAM_BOT_TOKEN = os.getenv('TELEGRAM_BOT_TOKEN')
TELEGRAM_CHAT_ID = os.getenv('TELEGRAM_CHAT_ID')
DEEPSEEK_API_KEY = os.getenv('DEEPSEEK_API_KEY')

# –§–∞–π–ª –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ update_id
STATE_FILE = Path('.auto_reply_state.json')

# –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –≤–æ–ø—Ä–æ—Å–∞ –¥–ª—è –æ—Ç–≤–µ—Ç–∞
MIN_QUESTION_LENGTH = 10

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –≤–æ–ø—Ä–æ—Å–∞ (—á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–ø–∞–º)
MAX_QUESTION_LENGTH = 500

# –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å
QUESTION_KEYWORDS = [
    '–∫–∞–∫', '—á—Ç–æ', '–ø–æ—á–µ–º—É', '–≥–¥–µ', '–∫–æ–≥–¥–∞', '—Å–∫–æ–ª—å–∫–æ', '–º–æ–∂–Ω–æ', 
    '–Ω—É–∂–Ω–æ', '–ø–æ–º–æ–≥–∏', '–ø–æ–¥—Å–∫–∞–∂–∏', '–æ–±—ä—è—Å–Ω–∏', '—Ä–∞—Å—Å–∫–∞–∂–∏',
    '–∫–∞–∫–æ–π', '–∫–∞–∫–∞—è', '–∫–∞–∫–æ–µ', '–∫–∞–∫–∏–µ', '—á–µ–º', '–∑–∞—á–µ–º'
]

# –°–ª–æ–≤–∞-—Ç—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
AUTO_REPLY_TRIGGERS = [
    '—Ç–∞–π–º–µ—Ä', 'tabata', 'hiit', 'amrap', 'emom', '—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞',
    '—É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ', '–ø—Ä–æ–≥—Ä–∞–º–º–∞', '—Ä–µ—Ü–µ–ø—Ç', '–ø–∏—Ç–∞–Ω–∏–µ', '–¥–∏–µ—Ç–∞',
    '–∫–∞–∫ –Ω–∞—á–∞—Ç—å', '—Å —á–µ–≥–æ –Ω–∞—á–∞—Ç—å', '–Ω–æ–≤–∏—á–æ–∫', '–Ω–∞—á–∞–ª—å–Ω—ã–π',
    '—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑', '—Å–∫–æ–ª—å–∫–æ –ø–æ–¥—Ö–æ–¥–æ–≤', '–∫–∞–∫ –¥–µ–ª–∞—Ç—å'
]

# –°–ª–æ–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ —Å–ø–∞–º (–Ω–µ –æ—Ç–≤–µ—á–∞–µ–º)
SPAM_KEYWORDS = [
    '–∫—É–ø–∏—Ç—å', '–ø—Ä–æ–¥–∞—Ç—å', '–∑–∞—Ä–∞–±–æ—Ç–æ–∫', '—Ä–µ–∫–ª–∞–º–∞', '—Å—Å—ã–ª–∫–∞',
    'bit.ly', 't.me/', 'http://', 'https://', '—Ä–µ—Ñ–µ—Ä–∞–ª'
]


def –∑–∞–≥—Ä—É–∑–∏—Ç—å_—Å–æ—Å—Ç–æ—è–Ω–∏–µ():
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π update_id"""
    if STATE_FILE.exists():
        try:
            with open(STATE_FILE, 'r', encoding='utf-8') as f:
                data = json.load(f)
                return data.get('last_update_id', 0)
        except Exception as e:
            print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è: {e}")
    return 0


def —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å_—Å–æ—Å—Ç–æ—è–Ω–∏–µ(update_id):
    """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π update_id"""
    try:
        with open(STATE_FILE, 'w', encoding='utf-8') as f:
            json.dump({'last_update_id': update_id}, f, ensure_ascii=False, indent=2)
    except Exception as e:
        print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è: {e}")


def –ø–æ–ª—É—á–∏—Ç—å_–Ω–æ–≤—ã–µ_–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏(last_update_id):
    """
    –ü–æ–ª—É—á–∞–µ—Ç –Ω–æ–≤—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏–∑ Telegram –∫–∞–Ω–∞–ª–∞.
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç getUpdates –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π.
    """
    url = f"https://api.telegram.org/bot{TELEGRAM_BOT_TOKEN}/getUpdates"
    params = {
        'offset': last_update_id + 1,
        'timeout': 10,
        'allowed_updates': ['message', 'channel_post', 'message_reaction']
    }
    
    try:
        response = requests.get(url, params=params, timeout=15)
        if response.status_code != 200:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π: {response.status_code}")
            return [], last_update_id
        
        data = response.json()
        if not data.get('ok'):
            print(f"‚ùå Telegram API –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É: {data.get('description')}")
            return [], last_update_id
        
        updates = data.get('result', [])
        –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ = []
        max_update_id = last_update_id
        
        for update in updates:
            update_id = update.get('update_id', 0)
            max_update_id = max(max_update_id, update_id)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–∞–Ω–∞–ª–µ (–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ–¥ –ø–æ—Å—Ç–∞–º–∏)
            message = update.get('message') or update.get('channel_post')
            if not message:
                continue
            
            # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –±–æ—Ç–∞
            if message.get('from', {}).get('is_bot'):
                continue
            
            # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –∏–∑ –Ω–∞—à–µ–≥–æ –∫–∞–Ω–∞–ª–∞
            chat_id = str(message.get('chat', {}).get('id', ''))
            if chat_id != str(TELEGRAM_CHAT_ID):
                continue
            
            # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
            text = message.get('text') or message.get('caption', '')
            if not text or len(text.strip()) < MIN_QUESTION_LENGTH:
                continue
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–≤–æ–∑–º–æ–∂–Ω–æ —Å–ø–∞–º)
            if len(text) > MAX_QUESTION_LENGTH:
                continue
            
            –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏.append({
                'update_id': update_id,
                'message_id': message.get('message_id'),
                'text': text.strip(),
                'from_user': message.get('from', {}).get('first_name', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'),
                'date': message.get('date', 0)
            })
        
        return –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, max_update_id
        
    except Exception as e:
        print(f"‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤: {e}")
        return [], last_update_id


def —ç—Ç–æ_–≤–æ–ø—Ä–æ—Å(—Ç–µ–∫—Å—Ç):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–æ–º"""
    —Ç–µ–∫—Å—Ç_–Ω–∏–∂–Ω–∏–π = —Ç–µ–∫—Å—Ç.lower()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –≤–æ–ø—Ä–æ—Å–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∑–Ω–∞–∫–∞
    if '?' in —Ç–µ–∫—Å—Ç:
        return True
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤–æ–ø—Ä–æ—Å–æ–≤
    for keyword in QUESTION_KEYWORDS:
        if keyword in —Ç–µ–∫—Å—Ç_–Ω–∏–∂–Ω–∏–π:
            return True
    
    return False


def —ç—Ç–æ_—Å–ø–∞–º(—Ç–µ–∫—Å—Ç):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—Å—Ç —Å–ø–∞–º–æ–º"""
    —Ç–µ–∫—Å—Ç_–Ω–∏–∂–Ω–∏–π = —Ç–µ–∫—Å—Ç.lower()
    
    for spam_word in SPAM_KEYWORDS:
        if spam_word in —Ç–µ–∫—Å—Ç_–Ω–∏–∂–Ω–∏–π:
            return True
    
    return False


def –Ω—É–∂–Ω–æ_–æ—Ç–≤–µ—á–∞—Ç—å(—Ç–µ–∫—Å—Ç):
    """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –Ω—É–∂–Ω–æ –ª–∏ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"""
    if not —ç—Ç–æ_–≤–æ–ø—Ä–æ—Å(—Ç–µ–∫—Å—Ç):
        return False
    
    if —ç—Ç–æ_—Å–ø–∞–º(—Ç–µ–∫—Å—Ç):
        return False
    
    —Ç–µ–∫—Å—Ç_–Ω–∏–∂–Ω–∏–π = —Ç–µ–∫—Å—Ç.lower()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
    for trigger in AUTO_REPLY_TRIGGERS:
        if trigger in —Ç–µ–∫—Å—Ç_–Ω–∏–∂–Ω–∏–π:
            return True
    
    # –ï—Å–ª–∏ —ç—Ç–æ –≤–æ–ø—Ä–æ—Å –∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª–∏–Ω–Ω—ã–π - –≤–µ—Ä–æ—è—Ç–Ω–æ, —Å—Ç–æ–∏—Ç –æ—Ç–≤–µ—Ç–∏—Ç—å
    if len(—Ç–µ–∫—Å—Ç) >= 20:
        return True
    
    return False


def —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å_–æ—Ç–≤–µ—Ç(–≤–æ–ø—Ä–æ—Å):
    """
    –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å —á–µ—Ä–µ–∑ DeepSeek AI
    """
    —Å–∏—Å—Ç–µ–º–Ω–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ = """–¢—ã - –ø–æ–º–æ—â–Ω–∏–∫ —Ñ–∏—Ç–Ω–µ—Å-–∫–∞–Ω–∞–ª–∞ @fitnesstimer. 
–û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ, –¥—Ä—É–∂–µ–ª—é–±–Ω–æ –∏ –ø–æ –¥–µ–ª—É. –ú–∞–∫—Å–∏–º—É–º 200 —Å–∏–º–≤–æ–ª–æ–≤.
–ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –Ω–µ –ø–æ —Ç–µ–º–µ —Ñ–∏—Ç–Ω–µ—Å–∞/—Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ - –≤–µ–∂–ª–∏–≤–æ —Å–∫–∞–∂–∏, —á—Ç–æ –Ω–µ –º–æ–∂–µ—à—å –ø–æ–º–æ—á—å.
–í—Å–µ–≥–¥–∞ –±—É–¥—å –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–º –∏ –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–º."""

    –ø—Ä–æ–º–ø—Ç = f"""–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–¥–∞–ª –≤–æ–ø—Ä–æ—Å –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö –∫ –ø–æ—Å—Ç—É –≤ —Ñ–∏—Ç–Ω–µ—Å-–∫–∞–Ω–∞–ª–µ:

"{–≤–æ–ø—Ä–æ—Å}"

–î–∞–π –∫—Ä–∞—Ç–∫–∏–π, –ø–æ–ª–µ–∑–Ω—ã–π –æ—Ç–≤–µ—Ç. –ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –ø—Ä–æ —Ç–∞–π–º–µ—Ä tabatatimer.ru - —É–ø–æ–º—è–Ω–∏ —Å—Å—ã–ª–∫—É https://tabatatimer.ru/#timer"""

    try:
        response = requests.post(
            "https://api.deepseek.com/v1/chat/completions",
            headers={
                "Authorization": f"Bearer {DEEPSEEK_API_KEY}",
                "Content-Type": "application/json"
            },
            json={
                "model": "deepseek-chat",
                "messages": [
                    {"role": "system", "content": —Å–∏—Å—Ç–µ–º–Ω–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ},
                    {"role": "user", "content": –ø—Ä–æ–º–ø—Ç}
                ],
                "temperature": 0.7,
                "max_tokens": 150
            },
            timeout=20
        )
        
        if response.status_code == 200:
            data = response.json()
            –æ—Ç–≤–µ—Ç = data['choices'][0]['message']['content'].strip()
            
            # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É –æ—Ç–≤–µ—Ç–∞
            if len(–æ—Ç–≤–µ—Ç) > 300:
                –æ—Ç–≤–µ—Ç = –æ—Ç–≤–µ—Ç[:297] + "..."
            
            return –æ—Ç–≤–µ—Ç
        else:
            print(f"‚ùå –û—à–∏–±–∫–∞ DeepSeek API: {response.status_code}")
            return None
            
    except Exception as e:
        print(f"‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞: {e}")
        return None


def –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_–æ—Ç–≤–µ—Ç(message_id, –æ—Ç–≤–µ—Ç):
    """
    –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ Telegram
    """
    url = f"https://api.telegram.org/bot{TELEGRAM_BOT_TOKEN}/sendMessage"
    
    params = {
        'chat_id': TELEGRAM_CHAT_ID,
        'text': f"üí¨ {–æ—Ç–≤–µ—Ç}",
        'reply_to_message_id': message_id,
        'parse_mode': 'HTML'
    }
    
    try:
        response = requests.post(url, json=params, timeout=10)
        if response.status_code == 200:
            return True
        else:
            print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞: {response.status_code}")
            print(f"–û—Ç–≤–µ—Ç API: {response.text}")
            return False
    except Exception as e:
        print(f"‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ—Ç–≤–µ—Ç–∞: {e}")
        return False


def –≥–ª–∞–≤–Ω–∞—è():
    """
    –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –Ω–∏—Ö
    """
    if not all([TELEGRAM_BOT_TOKEN, TELEGRAM_CHAT_ID, DEEPSEEK_API_KEY]):
        print("‚ùå –ù–µ –∑–∞–¥–∞–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è")
        print("–ù—É–∂–Ω—ã: TELEGRAM_BOT_TOKEN, TELEGRAM_CHAT_ID, DEEPSEEK_API_KEY")
        return False
    
    print("ü§ñ –ó–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤...")
    
    # –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    last_update_id = –∑–∞–≥—Ä—É–∑–∏—Ç—å_—Å–æ—Å—Ç–æ—è–Ω–∏–µ()
    print(f"üìå –ü–æ—Å–ª–µ–¥–Ω–∏–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π update_id: {last_update_id}")
    
    # –ü–æ–ª—É—á–∞–µ–º –Ω–æ–≤—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
    –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –Ω–æ–≤—ã–π_update_id = –ø–æ–ª—É—á–∏—Ç—å_–Ω–æ–≤—ã–µ_–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏(last_update_id)
    
    if not –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:
        print("‚úÖ –ù–æ–≤—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –Ω–µ—Ç")
        if –Ω–æ–≤—ã–π_update_id > last_update_id:
            —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å_—Å–æ—Å—Ç–æ—è–Ω–∏–µ(–Ω–æ–≤—ã–π_update_id)
        return True
    
    print(f"üì® –ù–∞–π–¥–µ–Ω–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤: {len(–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏)}")
    
    –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ = 0
    –æ—Ç–≤–µ—á–µ–Ω–æ = 0
    
    for –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π in –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:
        –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ += 1
        —Ç–µ–∫—Å—Ç = –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π['text']
        message_id = –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π['message_id']
        –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π['from_user']
        
        print(f"\nüí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç {–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å}: {—Ç–µ–∫—Å—Ç[:50]}...")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –æ—Ç–≤–µ—á–∞—Ç—å
        if not –Ω—É–∂–Ω–æ_–æ—Ç–≤–µ—á–∞—Ç—å(—Ç–µ–∫—Å—Ç):
            print("‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞–µ–º (–Ω–µ –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –Ω–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ)")
            continue
        
        print("ü§ñ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ DeepSeek...")
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç
        –æ—Ç–≤–µ—Ç = —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å_–æ—Ç–≤–µ—Ç(—Ç–µ–∫—Å—Ç)
        
        if not –æ—Ç–≤–µ—Ç:
            print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç")
            continue
        
        print(f"‚úÖ –û—Ç–≤–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω: {–æ—Ç–≤–µ—Ç[:50]}...")
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç
        if –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_–æ—Ç–≤–µ—Ç(message_id, –æ—Ç–≤–µ—Ç):
            –æ—Ç–≤–µ—á–µ–Ω–æ += 1
            print("‚úÖ –û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!")
        else:
            print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç")
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    if –Ω–æ–≤—ã–π_update_id > last_update_id:
        —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å_—Å–æ—Å—Ç–æ—è–Ω–∏–µ(–Ω–æ–≤—ã–π_update_id)
    
    print(f"\nüìä –ò—Ç–æ–≥–æ: –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ {–æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ}, –æ—Ç–≤–µ—á–µ–Ω–æ {–æ—Ç–≤–µ—á–µ–Ω–æ}")
    
    return True


if __name__ == "__main__":
    —É—Å–ø–µ—Ö = –≥–ª–∞–≤–Ω–∞—è()
    exit(0 if —É—Å–ø–µ—Ö else 1)


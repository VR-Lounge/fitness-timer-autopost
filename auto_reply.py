#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
    –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–≤–µ—Ç –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ Telegram
    
    –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ–¥ –ø–æ—Å—Ç–∞–º–∏ —á–µ—Ä–µ–∑ DeepSeek AI
    –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —á–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã.
    
    –ê–≤—Ç–æ—Ä: VR-Lounge
    –ö–∞–Ω–∞–ª: @fitnesstimer
"""

import os
import requests
import json
import re
import random
from datetime import datetime
from pathlib import Path

# ============= –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø =============

TELEGRAM_BOT_TOKEN = os.getenv('TELEGRAM_BOT_TOKEN')
TELEGRAM_CHAT_ID = os.getenv('TELEGRAM_CHAT_ID')
DEEPSEEK_API_KEY = os.getenv('DEEPSEEK_API_KEY')

# –§–∞–π–ª –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ update_id
STATE_FILE = Path('.auto_reply_state.json')

# –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –≤–æ–ø—Ä–æ—Å–∞ –¥–ª—è –æ—Ç–≤–µ—Ç–∞
MIN_QUESTION_LENGTH = 10

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –≤–æ–ø—Ä–æ—Å–∞ (—á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–ø–∞–º)
MAX_QUESTION_LENGTH = 500

# –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å
QUESTION_KEYWORDS = [
    '–∫–∞–∫', '—á—Ç–æ', '–ø–æ—á–µ–º—É', '–≥–¥–µ', '–∫–æ–≥–¥–∞', '—Å–∫–æ–ª—å–∫–æ', '–º–æ–∂–Ω–æ', 
    '–Ω—É–∂–Ω–æ', '–ø–æ–º–æ–≥–∏', '–ø–æ–¥—Å–∫–∞–∂–∏', '–æ–±—ä—è—Å–Ω–∏', '—Ä–∞—Å—Å–∫–∞–∂–∏',
    '–∫–∞–∫–æ–π', '–∫–∞–∫–∞—è', '–∫–∞–∫–æ–µ', '–∫–∞–∫–∏–µ', '—á–µ–º', '–∑–∞—á–µ–º'
]

# –°–ª–æ–≤–∞-—Ç—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
AUTO_REPLY_TRIGGERS = [
    '—Ç–∞–π–º–µ—Ä', 'tabata', 'hiit', 'amrap', 'emom', '—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞',
    '—É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ', '–ø—Ä–æ–≥—Ä–∞–º–º–∞', '—Ä–µ—Ü–µ–ø—Ç', '–ø–∏—Ç–∞–Ω–∏–µ', '–¥–∏–µ—Ç–∞',
    '–∫–∞–∫ –Ω–∞—á–∞—Ç—å', '—Å —á–µ–≥–æ –Ω–∞—á–∞—Ç—å', '–Ω–æ–≤–∏—á–æ–∫', '–Ω–∞—á–∞–ª—å–Ω—ã–π',
    '—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑', '—Å–∫–æ–ª—å–∫–æ –ø–æ–¥—Ö–æ–¥–æ–≤', '–∫–∞–∫ –¥–µ–ª–∞—Ç—å'
]

# –°–ª–æ–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ —Å–ø–∞–º (–Ω–µ –æ—Ç–≤–µ—á–∞–µ–º)
SPAM_KEYWORDS = [
    '–∫—É–ø–∏—Ç—å', '–ø—Ä–æ–¥–∞—Ç—å', '–∑–∞—Ä–∞–±–æ—Ç–æ–∫', '—Ä–µ–∫–ª–∞–º–∞', '—Å—Å—ã–ª–∫–∞',
    'bit.ly', 't.me/', 'http://', 'https://', '—Ä–µ—Ñ–µ—Ä–∞–ª'
]

# –ú—É–¥—Ä—ã–µ —Ü–∏—Ç–∞—Ç—ã –¥–ª—è –º–æ—Ç–∏–≤–∞—Ü–∏–∏
–ú–û–¢–ò–í–ê–¶–ò–û–ù–ù–´–ï_–¶–ò–¢–ê–¢–´ = [
    "–ö–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ê—Ä–Ω–æ–ª—å–¥ –®–≤–∞—Ä—Ü–µ–Ω–µ–≥–≥–µ—Ä: '–ë–æ–ª—å ‚Äî —ç—Ç–æ —Å–ª–∞–±–æ—Å—Ç—å, –ø–æ–∫–∏–¥–∞—é—â–∞—è —Ç–µ–ª–æ' üí™",
    "–ü–æ–º–Ω–∏: '–£—Å–ø–µ—Ö ‚Äî —ç—Ç–æ —Å—É–º–º–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —É—Å–∏–ª–∏–π, –ø–æ–≤—Ç–æ—Ä—è–µ–º—ã—Ö –∏–∑–æ –¥–Ω—è –≤ –¥–µ–Ω—å' ‚Äî –†–æ–±–µ—Ä—Ç –ö–æ–ª—å–µ—Ä üî•",
    "–ö–∞–∫ —Å–∫–∞–∑–∞–ª –ë—Ä—é—Å –õ–∏: '–Ø –Ω–µ –±–æ—é—Å—å —Ç–æ–≥–æ, –∫—Ç–æ –∏–∑—É—á–∞–µ—Ç 10,000 —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —É–¥–∞—Ä–æ–≤. –Ø –±–æ—é—Å—å —Ç–æ–≥–æ, –∫—Ç–æ –∏–∑—É—á–∞–µ—Ç –æ–¥–∏–Ω —É–¥–∞—Ä 10,000 —Ä–∞–∑' ‚ö°",
    "'–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–ª–æ—Ö–æ–π —Ç—Ä–µ–Ω–∏–Ω–≥ ‚Äî —ç—Ç–æ —Ç–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —Å–æ—Å—Ç–æ—è–ª—Å—è' ‚Äî –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –º—É–¥—Ä–µ—Ü üíØ",
    "'–í–∞—à–µ —Ç–µ–ª–æ –º–æ–∂–µ—Ç –≤—Å—ë. –≠—Ç–æ –≤–∞—à —Ä–∞–∑—É–º –Ω—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å' ‚Äî –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞—Ç–ª–µ—Ç üß†",
    "'–ù–µ –∂–¥–∏—Ç–µ –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞. –ù–∞—á–Ω–∏—Ç–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å' ‚Äî –î–∂–∏–º –†–æ–Ω üöÄ",
    "'–ë–æ–ª—å –≤—Ä–µ–º–µ–Ω–Ω–∞, –≥–æ—Ä–¥–æ—Å—Ç—å ‚Äî –Ω–∞–≤—Å–µ–≥–¥–∞' ‚Äî –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–ª–∞–∫–∞—Ç –≤ —Å–ø–æ—Ä—Ç–∑–∞–ª–µ üíé"
]

# –°—Å—ã–ª–∫–∏ –Ω–∞ SportWiki –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–µ–º
SPORTWIKI_–°–°–´–õ–ö–ò = {
    '—Ç–∞–±–∞—Ç–∞': 'https://sportwiki.to/–¢–∞–±–∞—Ç–∞',
    'hiit': 'https://sportwiki.to/–í–ò–ò–¢',
    '—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞': 'https://sportwiki.to/–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞',
    '–ø–∏—Ç–∞–Ω–∏–µ': 'https://sportwiki.to/–°–ø–æ—Ä—Ç–∏–≤–Ω–æ–µ_–ø–∏—Ç–∞–Ω–∏–µ',
    '—Ä–µ—Ü–µ–ø—Ç': 'https://sportwiki.to/–°–ø–æ—Ä—Ç–∏–≤–Ω–∞—è_–¥–∏–µ—Ç–∞',
    '—É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ': 'https://sportwiki.to/–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è',
    '–ø—Ä–æ–≥—Ä–∞–º–º–∞': 'https://sportwiki.to/–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω–∞—è_–ø—Ä–æ–≥—Ä–∞–º–º–∞',
    '–Ω–∞—á–∏–Ω–∞—é—â–∏–π': 'https://sportwiki.to/–ù–æ–≤–∏—á–æ–∫',
    '—Å–∏–ª–∞': 'https://sportwiki.to/–°–∏–ª–∞',
    '–≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å': 'https://sportwiki.to/–í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å'
}


def –∑–∞–≥—Ä—É–∑–∏—Ç—å_—Å–æ—Å—Ç–æ—è–Ω–∏–µ():
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π update_id"""
    if STATE_FILE.exists():
        try:
            with open(STATE_FILE, 'r', encoding='utf-8') as f:
                data = json.load(f)
                return data.get('last_update_id', 0)
        except Exception as e:
            print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è: {e}")
    return 0


def —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å_—Å–æ—Å—Ç–æ—è–Ω–∏–µ(update_id):
    """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π update_id"""
    try:
        with open(STATE_FILE, 'w', encoding='utf-8') as f:
            json.dump({'last_update_id': update_id}, f, ensure_ascii=False, indent=2)
    except Exception as e:
        print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è: {e}")


def –ø–æ–ª—É—á–∏—Ç—å_–Ω–æ–≤—ã–µ_–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏(last_update_id):
    """
    –ü–æ–ª—É—á–∞–µ—Ç –Ω–æ–≤—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏–∑ Telegram –∫–∞–Ω–∞–ª–∞.
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç getUpdates –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π.
    """
    url = f"https://api.telegram.org/bot{TELEGRAM_BOT_TOKEN}/getUpdates"
    params = {
        'offset': last_update_id + 1,
        'timeout': 10,
        'allowed_updates': ['message', 'channel_post', 'message_reaction']
    }
    
    try:
        response = requests.get(url, params=params, timeout=15)
        if response.status_code != 200:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π: {response.status_code}")
            return [], last_update_id
        
        data = response.json()
        if not data.get('ok'):
            print(f"‚ùå Telegram API –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É: {data.get('description')}")
            return [], last_update_id
        
        updates = data.get('result', [])
        –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ = []
        max_update_id = last_update_id
        
        for update in updates:
            update_id = update.get('update_id', 0)
            max_update_id = max(max_update_id, update_id)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–∞–Ω–∞–ª–µ (–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ–¥ –ø–æ—Å—Ç–∞–º–∏)
            message = update.get('message') or update.get('channel_post')
            if not message:
                continue
            
            # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –±–æ—Ç–∞
            if message.get('from', {}).get('is_bot'):
                continue
            
            # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –∏–∑ –Ω–∞—à–µ–≥–æ –∫–∞–Ω–∞–ª–∞
            chat_id = str(message.get('chat', {}).get('id', ''))
            if chat_id != str(TELEGRAM_CHAT_ID):
                continue
            
            # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
            text = message.get('text') or message.get('caption', '')
            if not text or len(text.strip()) < MIN_QUESTION_LENGTH:
                continue
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–≤–æ–∑–º–æ–∂–Ω–æ —Å–ø–∞–º)
            if len(text) > MAX_QUESTION_LENGTH:
                continue
            
            –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏.append({
                'update_id': update_id,
                'message_id': message.get('message_id'),
                'text': text.strip(),
                'from_user': message.get('from', {}).get('first_name', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'),
                'date': message.get('date', 0)
            })
        
        return –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, max_update_id
        
    except Exception as e:
        print(f"‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤: {e}")
        return [], last_update_id


def —ç—Ç–æ_–≤–æ–ø—Ä–æ—Å(—Ç–µ–∫—Å—Ç):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–æ–º"""
    —Ç–µ–∫—Å—Ç_–Ω–∏–∂–Ω–∏–π = —Ç–µ–∫—Å—Ç.lower()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –≤–æ–ø—Ä–æ—Å–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∑–Ω–∞–∫–∞
    if '?' in —Ç–µ–∫—Å—Ç:
        return True
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤–æ–ø—Ä–æ—Å–æ–≤
    for keyword in QUESTION_KEYWORDS:
        if keyword in —Ç–µ–∫—Å—Ç_–Ω–∏–∂–Ω–∏–π:
            return True
    
    return False


def —ç—Ç–æ_—Å–ø–∞–º(—Ç–µ–∫—Å—Ç):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—Å—Ç —Å–ø–∞–º–æ–º"""
    —Ç–µ–∫—Å—Ç_–Ω–∏–∂–Ω–∏–π = —Ç–µ–∫—Å—Ç.lower()
    
    for spam_word in SPAM_KEYWORDS:
        if spam_word in —Ç–µ–∫—Å—Ç_–Ω–∏–∂–Ω–∏–π:
            return True
    
    return False


def –Ω—É–∂–Ω–æ_–æ—Ç–≤–µ—á–∞—Ç—å(—Ç–µ–∫—Å—Ç):
    """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –Ω—É–∂–Ω–æ –ª–∏ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"""
    if not —ç—Ç–æ_–≤–æ–ø—Ä–æ—Å(—Ç–µ–∫—Å—Ç):
        return False
    
    if —ç—Ç–æ_—Å–ø–∞–º(—Ç–µ–∫—Å—Ç):
        return False
    
    —Ç–µ–∫—Å—Ç_–Ω–∏–∂–Ω–∏–π = —Ç–µ–∫—Å—Ç.lower()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
    for trigger in AUTO_REPLY_TRIGGERS:
        if trigger in —Ç–µ–∫—Å—Ç_–Ω–∏–∂–Ω–∏–π:
            return True
    
    # –ï—Å–ª–∏ —ç—Ç–æ –≤–æ–ø—Ä–æ—Å –∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª–∏–Ω–Ω—ã–π - –≤–µ—Ä–æ—è—Ç–Ω–æ, —Å—Ç–æ–∏—Ç –æ—Ç–≤–µ—Ç–∏—Ç—å
    if len(—Ç–µ–∫—Å—Ç) >= 20:
        return True
    
    return False


def –ø–æ–ª—É—á–∏—Ç—å_—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é_—Å—Å—ã–ª–∫—É_sportwiki(–≤–æ–ø—Ä–æ—Å):
    """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ SportWiki –ø–æ –≤–æ–ø—Ä–æ—Å—É"""
    –≤–æ–ø—Ä–æ—Å_–Ω–∏–∂–Ω–∏–π = –≤–æ–ø—Ä–æ—Å.lower()
    for –∫–ª—é—á, —Å—Å—ã–ª–∫–∞ in SPORTWIKI_–°–°–´–õ–ö–ò.items():
        if –∫–ª—é—á in –≤–æ–ø—Ä–æ—Å_–Ω–∏–∂–Ω–∏–π:
            return —Å—Å—ã–ª–∫–∞
    return None


def –ø–æ–ª—É—á–∏—Ç—å_—Å–ª—É—á–∞–π–Ω—É—é_—Ü–∏—Ç–∞—Ç—É():
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—É—é –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—É—é —Ü–∏—Ç–∞—Ç—É"""
    return random.choice(–ú–û–¢–ò–í–ê–¶–ò–û–ù–ù–´–ï_–¶–ò–¢–ê–¢–´)


def —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å_–æ—Ç–≤–µ—Ç(–≤–æ–ø—Ä–æ—Å):
    """
    –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∂–∏–≤–æ–π, –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–π –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å —á–µ—Ä–µ–∑ DeepSeek AI
    —Å –Ω–∞—É—á–Ω—ã–º–∏ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏—è–º–∏ –∏ —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ SportWiki
    """
    —Å–∏—Å—Ç–µ–º–Ω–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ = """–¢—ã - –∂–∏–≤–æ–π, –≤–µ—Å—ë–ª—ã–π –∏ –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–π –ø–æ–º–æ—â–Ω–∏–∫ —Ñ–∏—Ç–Ω–µ—Å-–∫–∞–Ω–∞–ª–∞ @fitnesstimer. 
–¢–≤–æ–π —Å—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è:
- –î—Ä—É–∂–µ–ª—é–±–Ω—ã–π, –∫–∞–∫ –ª—É—á—à–∏–π –¥—Ä—É–≥ –≤ —Å–ø–æ—Ä—Ç–∑–∞–ª–µ
- –ñ–∏–≤–æ–π –∏ —ç–Ω–µ—Ä–≥–∏—á–Ω—ã–π, —Å —ç–Ω—Ç—É–∑–∏–∞–∑–º–æ–º
- –ú–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–π –∏ –ø–æ–¥–±–∞–¥—Ä–∏–≤–∞—é—â–∏–π
- –ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏ –¥–ª—è –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–Ω–æ –Ω–µ –ø–µ—Ä–µ–±–æ—Ä—â–∏)
- –ü–æ–¥–∫—Ä–µ–ø–ª—è–π —Å–æ–≤–µ—Ç—ã –Ω–∞—É—á–Ω—ã–º–∏ —Ñ–∞–∫—Ç–∞–º–∏ (—Å—Å—ã–ª–∞–π—Å—è –Ω–∞ SportWiki)
- –í—Å—Ç–∞–≤–ª—è–π –º—É–¥—Ä—ã–µ —Ü–∏—Ç–∞—Ç—ã, –∫–æ–≥–¥–∞ —É–º–µ—Å—Ç–Ω–æ
- –ë—É–¥—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∏ –ø—Ä–∞–∫—Ç–∏—á–Ω—ã–º
- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–æ–¥–±–æ–¥—Ä–∏—Ç—å - –ø–æ–¥–±–æ–¥—Ä–∏!

–û—Ç–≤–µ—á–∞–π —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–æ (–¥–æ 400 —Å–∏–º–≤–æ–ª–æ–≤), –Ω–æ –Ω–µ –∑–∞–Ω—É–¥–Ω–æ. 
–ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –Ω–µ –ø–æ —Ç–µ–º–µ —Ñ–∏—Ç–Ω–µ—Å–∞ - –≤–µ–∂–ª–∏–≤–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤—å –Ω–∞ —Ç–µ–º—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫."""

    # –ü–æ–ª—É—á–∞–µ–º —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ SportWiki
    sportwiki_—Å—Å—ã–ª–∫–∞ = –ø–æ–ª—É—á–∏—Ç—å_—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é_—Å—Å—ã–ª–∫—É_sportwiki(–≤–æ–ø—Ä–æ—Å)
    sportwiki_—á–∞—Å—Ç—å = ""
    if sportwiki_—Å—Å—ã–ª–∫–∞:
        sportwiki_—á–∞—Å—Ç—å = f"\n\nüìö –ù–∞—É—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ —Ç–µ–º–µ: {sportwiki_—Å—Å—ã–ª–∫–∞}"
    
    # –ü–æ–ª—É—á–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é —Ü–∏—Ç–∞—Ç—É (—Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é 30%)
    —Ü–∏—Ç–∞—Ç–∞_—á–∞—Å—Ç—å = ""
    if random.random() < 0.3:
        —Ü–∏—Ç–∞—Ç–∞_—á–∞—Å—Ç—å = f"\n\nüí¨ {–ø–æ–ª—É—á–∏—Ç—å_—Å–ª—É—á–∞–π–Ω—É—é_—Ü–∏—Ç–∞—Ç—É()}"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ —É–ø–æ–º—è–Ω—É—Ç—å –æ—Ñ—Ñ–µ—Ä (–Ω–µ–Ω–∞–≤—è–∑—á–∏–≤–æ, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ)
    –æ—Ñ—Ñ–µ—Ä_—á–∞—Å—Ç—å = ""
    –≤–æ–ø—Ä–æ—Å_–Ω–∏–∂–Ω–∏–π = –≤–æ–ø—Ä–æ—Å.lower()
    if any(word in –≤–æ–ø—Ä–æ—Å_–Ω–∏–∂–Ω–∏–π for word in ['–ø—Ä–æ–≥—Ä–∞–º–º–∞', '–∫—É—Ä—Å', '–æ–±—É—á–µ–Ω–∏–µ', '–ø–æ–º–æ—â—å', '—Ä–µ–∑—É–ª—å—Ç–∞—Ç', '—É—Å–ø–µ—Ö']):
        –æ—Ñ—Ñ–µ—Ä_—á–∞—Å—Ç—å = "\n\nüéØ –ö—Å—Ç–∞—Ç–∏, —É –Ω–∞—Å –µ—Å—Ç—å –∫—Ä—É—Ç—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–π! –ü–æ–¥—Ä–æ–±–Ω–µ–µ: https://telegra.ph/OFFER-NA-MILLIARD-07-08"
    
    –ø—Ä–æ–º–ø—Ç = f"""–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–¥–∞–ª –≤–æ–ø—Ä–æ—Å –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö –∫ –ø–æ—Å—Ç—É –≤ —Ñ–∏—Ç–Ω–µ—Å-–∫–∞–Ω–∞–ª–µ:

"{–≤–æ–ø—Ä–æ—Å}"

–î–∞–π –∂–∏–≤–æ–π, –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –∏ –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–π –æ—Ç–≤–µ—Ç:
- –ë—É–¥—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∏ –ø—Ä–∞–∫—Ç–∏—á–Ω—ã–º
- –ü–æ–¥–∫—Ä–µ–ø–ª—è–π —Å–æ–≤–µ—Ç—ã –Ω–∞—É—á–Ω—ã–º–∏ —Ñ–∞–∫—Ç–∞–º–∏ (–º–æ–∂–Ω–æ —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ SportWiki)
- –ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –ø—Ä–æ —Ç–∞–π–º–µ—Ä tabatatimer.ru - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–ø–æ–º—è–Ω–∏ —Å—Å—ã–ª–∫—É https://tabatatimer.ru/#timer
- –ë—É–¥—å —ç–Ω–µ—Ä–≥–∏—á–Ω—ã–º –∏ –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–º
- –ï—Å–ª–∏ —á–µ–ª–æ–≤–µ–∫ —Å–æ–º–Ω–µ–≤–∞–µ—Ç—Å—è –∏–ª–∏ –Ω—É–∂–¥–∞–µ—Ç—Å—è –≤ –ø–æ–¥–¥–µ—Ä–∂–∫–µ - –ø–æ–¥–±–æ–¥—Ä–∏ –µ–≥–æ!

{sportwiki_—á–∞—Å—Ç—å}{—Ü–∏—Ç–∞—Ç–∞_—á–∞—Å—Ç—å}{–æ—Ñ—Ñ–µ—Ä_—á–∞—Å—Ç—å}

–°—Ñ–æ—Ä–º–∏—Ä—É–π –æ—Ç–≤–µ—Ç –≤ –¥—Ä—É–∂–µ–ª—é–±–Ω–æ–º, –∂–∏–≤–æ–º —Å—Ç–∏–ª–µ, –∫–∞–∫ –±—É–¥—Ç–æ —Ç—ã –ª—É—á—à–∏–π –¥—Ä—É–≥, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç —Å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º–∏."""

    try:
        response = requests.post(
            "https://api.deepseek.com/v1/chat/completions",
            headers={
                "Authorization": f"Bearer {DEEPSEEK_API_KEY}",
                "Content-Type": "application/json"
            },
            json={
                "model": "deepseek-chat",
                "messages": [
                    {"role": "system", "content": —Å–∏—Å—Ç–µ–º–Ω–æ–µ_—Å–æ–æ–±—â–µ–Ω–∏–µ},
                    {"role": "user", "content": –ø—Ä–æ–º–ø—Ç}
                ],
                "temperature": 0.85,  # –ü–æ–≤—ã—à–∞–µ–º –¥–ª—è –±–æ–ª–µ–µ –∂–∏–≤—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
                "max_tokens": 400  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–ª—è —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
            },
            timeout=20
        )
        
        if response.status_code == 200:
            data = response.json()
            –æ—Ç–≤–µ—Ç = data['choices'][0]['message']['content'].strip()
            
            # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É –æ—Ç–≤–µ—Ç–∞ (Telegram –ª–∏–º–∏—Ç –¥–ª—è –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è ~4096 —Å–∏–º–≤–æ–ª–æ–≤)
            # –ù–æ –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ª—É—á—à–µ –∫–æ—Ä–æ—á–µ - –¥–æ 500 —Å–∏–º–≤–æ–ª–æ–≤
            if len(–æ—Ç–≤–µ—Ç) > 500:
                –æ—Ç–≤–µ—Ç = –æ—Ç–≤–µ—Ç[:497] + "..."
            
            return –æ—Ç–≤–µ—Ç
        else:
            print(f"‚ùå –û—à–∏–±–∫–∞ DeepSeek API: {response.status_code}")
            return None
            
    except Exception as e:
        print(f"‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞: {e}")
        return None


def –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_–æ—Ç–≤–µ—Ç(message_id, –æ—Ç–≤–µ—Ç):
    """
    –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ Telegram
    """
    url = f"https://api.telegram.org/bot{TELEGRAM_BOT_TOKEN}/sendMessage"
    
    # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç: —É–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–π –ø—Ä–µ—Ñ–∏–∫—Å, –µ—Å–ª–∏ –æ–Ω —É–∂–µ –µ—Å—Ç—å
    if –æ—Ç–≤–µ—Ç.startswith("üí¨"):
        —Ç–µ–∫—Å—Ç_–æ—Ç–≤–µ—Ç–∞ = –æ—Ç–≤–µ—Ç
    else:
        —Ç–µ–∫—Å—Ç_–æ—Ç–≤–µ—Ç–∞ = f"üí¨ {–æ—Ç–≤–µ—Ç}"
    
    params = {
        'chat_id': TELEGRAM_CHAT_ID,
        'text': —Ç–µ–∫—Å—Ç_–æ—Ç–≤–µ—Ç–∞,
        'reply_to_message_id': message_id,
        'parse_mode': 'HTML',
        'disable_web_page_preview': False  # –†–∞–∑—Ä–µ—à–∞–µ–º –ø—Ä–µ–≤—å—é —Å—Å—ã–ª–æ–∫
    }
    
    try:
        response = requests.post(url, json=params, timeout=10)
        if response.status_code == 200:
            return True
        else:
            print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞: {response.status_code}")
            print(f"–û—Ç–≤–µ—Ç API: {response.text}")
            return False
    except Exception as e:
        print(f"‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ—Ç–≤–µ—Ç–∞: {e}")
        return False


def –≥–ª–∞–≤–Ω–∞—è():
    """
    –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –Ω–∏—Ö
    """
    if not all([TELEGRAM_BOT_TOKEN, TELEGRAM_CHAT_ID, DEEPSEEK_API_KEY]):
        print("‚ùå –ù–µ –∑–∞–¥–∞–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è")
        print("–ù—É–∂–Ω—ã: TELEGRAM_BOT_TOKEN, TELEGRAM_CHAT_ID, DEEPSEEK_API_KEY")
        return False
    
    print("ü§ñ –ó–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤...")
    
    # –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    last_update_id = –∑–∞–≥—Ä—É–∑–∏—Ç—å_—Å–æ—Å—Ç–æ—è–Ω–∏–µ()
    print(f"üìå –ü–æ—Å–ª–µ–¥–Ω–∏–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π update_id: {last_update_id}")
    
    # –ü–æ–ª—É—á–∞–µ–º –Ω–æ–≤—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
    –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –Ω–æ–≤—ã–π_update_id = –ø–æ–ª—É—á–∏—Ç—å_–Ω–æ–≤—ã–µ_–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏(last_update_id)
    
    if not –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:
        print("‚úÖ –ù–æ–≤—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –Ω–µ—Ç")
        if –Ω–æ–≤—ã–π_update_id > last_update_id:
            —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å_—Å–æ—Å—Ç–æ—è–Ω–∏–µ(–Ω–æ–≤—ã–π_update_id)
        return True
    
    print(f"üì® –ù–∞–π–¥–µ–Ω–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤: {len(–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏)}")
    
    –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ = 0
    –æ—Ç–≤–µ—á–µ–Ω–æ = 0
    
    for –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π in –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:
        –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ += 1
        —Ç–µ–∫—Å—Ç = –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π['text']
        message_id = –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π['message_id']
        –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π['from_user']
        
        print(f"\nüí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç {–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å}: {—Ç–µ–∫—Å—Ç[:50]}...")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –æ—Ç–≤–µ—á–∞—Ç—å
        if not –Ω—É–∂–Ω–æ_–æ—Ç–≤–µ—á–∞—Ç—å(—Ç–µ–∫—Å—Ç):
            print("‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞–µ–º (–Ω–µ –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –Ω–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ)")
            continue
        
        print("ü§ñ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ DeepSeek...")
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç
        –æ—Ç–≤–µ—Ç = —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å_–æ—Ç–≤–µ—Ç(—Ç–µ–∫—Å—Ç)
        
        if not –æ—Ç–≤–µ—Ç:
            print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç")
            continue
        
        print(f"‚úÖ –û—Ç–≤–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω: {–æ—Ç–≤–µ—Ç[:50]}...")
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç
        if –æ—Ç–ø—Ä–∞–≤–∏—Ç—å_–æ—Ç–≤–µ—Ç(message_id, –æ—Ç–≤–µ—Ç):
            –æ—Ç–≤–µ—á–µ–Ω–æ += 1
            print("‚úÖ –û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!")
        else:
            print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç")
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    if –Ω–æ–≤—ã–π_update_id > last_update_id:
        —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å_—Å–æ—Å—Ç–æ—è–Ω–∏–µ(–Ω–æ–≤—ã–π_update_id)
    
    print(f"\nüìä –ò—Ç–æ–≥–æ: –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ {–æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ}, –æ—Ç–≤–µ—á–µ–Ω–æ {–æ—Ç–≤–µ—á–µ–Ω–æ}")
    
    return True


if __name__ == "__main__":
    —É—Å–ø–µ—Ö = –≥–ª–∞–≤–Ω–∞—è()
    exit(0 if —É—Å–ø–µ—Ö else 1)


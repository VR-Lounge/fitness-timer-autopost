# Инструкция по настройке DeepSeek API

Эта инструкция поможет вам настроить DeepSeek API для автоматической проверки изображений в системе автопостинга FITNESS TIMER.

## Шаг 1: Получение API ключа от DeepSeek

1. Перейдите на платформу DeepSeek: https://platform.deepseek.com/
2. Зарегистрируйтесь или войдите в свой аккаунт
3. Перейдите в раздел "API keys": https://platform.deepseek.com/api_keys
4. Нажмите кнопку "Create API key" или используйте существующий ключ
5. Скопируйте ваш API ключ (формат: sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxx)
6. Сохраните ключ в безопасном месте - он показывается только один раз!

### Важно:
- API ключ можно увидеть только при создании
- Храните ключ в надежном месте
- Не делитесь ключом с другими людьми
- Не публикуйте ключ в открытом коде

## Шаг 2: Добавление ключа в GitHub Secrets

1. Откройте ваш репозиторий: https://github.com/VR-Lounge/fitness-timer-autopost
2. Перейдите в Settings → Secrets and variables → Actions
3. Нажмите "New repository secret"
4. Создайте секрет с именем: `DEEPSEEK_API_KEY`
5. Вставьте ваш API ключ в поле Value
6. Нажмите "Add secret"

### Проверка секрета:
- Убедитесь, что секрет создан с правильным именем: DEEPSEEK_API_KEY
- Секрет должен быть доступен для GitHub Actions
- После сохранения значение секрета будет скрыто

## Шаг 3: Проверка работы API (опционально)

После добавления API ключа в GitHub Secrets, система автоматически начнет использовать DeepSeek для проверки изображений.

### Как проверить:
1. Запустите любой workflow (Women's Health или Men's Health parser)
2. Дождитесь завершения выполнения
3. Проверьте логи - должны появиться сообщения о проверке изображений через DeepSeek
4. Проверьте результаты в Telegram канале

### Признаки успешной работы:
- В логах появляются сообщения "Проверка изображения через DeepSeek API"
- Изображения с неподходящим контентом отфильтровываются
- В Telegram публикуются только проверенные изображения

## Где используется DeepSeek API

DeepSeek API используется в следующих компонентах системы:

### 1. Парсеры RSS лент
- **womenshealth-parser.yml** - обработка женских тренировок
- **menshealth-parser.yml** - обработка мужских тренировок

### 2. Проверка изображений
Каждое изображение из RSS-ленты проходит проверку через DeepSeek Vision API перед публикацией:
- Определение соответствия контента тематике фитнеса
- Проверка на нежелательный контент
- Оценка качества и релевантности изображения

### 3. Автоматическая фильтрация
Система автоматически отбрасывает изображения, которые:
- Не соответствуют тематике фитнеса и здоровья
- Содержат нежелательный контент
- Имеют низкое качество
- Не подходят для публикации в Telegram канале

## Как работает проверка изображений

### Процесс проверки:

1. **Загрузка изображения**
   - Система получает URL изображения из RSS-ленты
   - Изображение загружается для анализа

2. **Отправка в DeepSeek API**
   - Используется модель `deepseek-chat`
   - Изображение кодируется в base64 (если требуется)
   - Отправляется запрос с промптом для анализа

3. **Анализ контента**
   DeepSeek анализирует изображение по критериям:
   - Релевантность теме фитнеса/тренировок/здоровья
   - Качество изображения
   - Отсутствие нежелательного контента
   - Соответствие аудитории Telegram канала

4. **Принятие решения**
   - Система получает ответ от DeepSeek
   - Принимается решение о публикации или отклонении
   - Результат логируется для анализа

5. **Публикация или отклонение**
   - Прошедшие проверку изображения публикуются в Telegram
   - Отклоненные изображения исключаются из публикации
   - Ведется статистика проверок

### Критерии проверки:

✅ **Подходит для публикации:**
- Фитнес упражнения и тренировки
- Демонстрация правильной техники
- Спортивное оборудование и инвентарь
- Здоровое питание и рецепты
- Мотивационные изображения по фитнесу
- Результаты тренировок (до/после)

❌ **Не подходит для публикации:**
- Не связано с фитнесом или здоровьем
- Нежелательный или неуместный контент
- Низкое качество изображения
- Рекламные материалы сторонних брендов
- Изображения с текстом, не относящимся к теме

## Информация о стоимости

### Модель DeepSeek Chat
- **Используемая модель:** `deepseek-chat`
- **Тип запросов:** Vision (анализ изображений)

### Текущие тарифы DeepSeek:

**Input (входящие данные):**
- Без кеша: $0.14 / 1M tokens
- С кешем: $0.014 / 1M tokens (скидка 90%)

**Output (исходящие данные):**
- $0.28 / 1M tokens

### Примерные расходы:

**При текущей нагрузке:**
- 6 публикаций в день (3 для сайта + 6 для Telegram)
- Каждая публикация = 1 проверка изображения
- Примерно 180-240 проверок в месяц
- Средний размер запроса: 500-1000 tokens
- Средний размер ответа: 100-200 tokens

**Ожидаемая стоимость:**
- Месячные расходы: $0.06 - $0.10
- Годовые расходы: $0.72 - $1.20

**Текущий баланс:** $6.88 USD (по состоянию на проверку)

### Оптимизация расходов:

1. **Использование кеша**
   - Повторяющиеся запросы кешируются
   - Экономия до 90% на входящих данных

2. **Оптимизация промптов**
   - Краткие и четкие инструкции
   - Минимизация размера запросов

3. **Пакетная обработка**
   - Группировка проверок
   - Снижение количества API вызовов

### Мониторинг расходов:

Проверить текущие расходы можно здесь:
- **Usage Dashboard:** https://platform.deepseek.com/usage
- **API Keys:** https://platform.deepseek.com/api_keys

Рекомендуется проверять баланс еженедельно и настроить уведомления о низком балансе.

## Проверка настройки

### Checklist успешной настройки:

- [ ] API ключ получен от DeepSeek
- [ ] API ключ добавлен в GitHub Secrets как `DEEPSEEK_API_KEY`
- [ ] Workflows успешно запускаются
- [ ] В логах появляются сообщения о проверке изображений
- [ ] Изображения публикуются в Telegram канале
- [ ] Баланс DeepSeek API достаточный ($6.88 - хватит надолго)

### Если что-то не работает:

1. **Проверьте API ключ:**
   - Ключ правильно скопирован
   - Ключ активен на платформе DeepSeek
   - Ключ добавлен в GitHub Secrets с правильным именем

2. **Проверьте логи GitHub Actions:**
   - Откройте последний запуск workflow
   - Найдите сообщения об ошибках
   - Проверьте доступность секрета DEEPSEEK_API_KEY

3. **Проверьте баланс:**
   - Достаточно ли средств на аккаунте DeepSeek
   - Не заблокирован ли API ключ

4. **Проверьте соединение:**
   - DeepSeek API доступен
   - Нет проблем с сетью
   - GitHub Actions может обращаться к внешним API

### Полезные ссылки:

- **DeepSeek Platform:** https://platform.deepseek.com/
- **DeepSeek Usage:** https://platform.deepseek.com/usage
- **DeepSeek API Keys:** https://platform.deepseek.com/api_keys
- **GitHub Repository:** https://github.com/VR-Lounge/fitness-timer-autopost
- **GitHub Actions:** https://github.com/VR-Lounge/fitness-timer-autopost/actions
- **Telegram Channel:** https://t.me/fitnesstimer

### Контакты для поддержки:

Если у вас возникли вопросы или проблемы с настройкой:
- **Admin Telegram:** @lobanoff_pro
- **Admin Chat ID:** 422372115

---

**Дата создания:** 2025-01-26
**Версия:** 1.0
**Автор:** LOBANOFF-PRO
**Статус:** Активно используется
